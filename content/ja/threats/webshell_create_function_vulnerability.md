---
date: 2024-06-03
draft: false
title: "[WEB] Webshell攻撃とcreate_function関数の脆弱性"
description: 
featured_image: "cdn/column/webshell_attack_and_create_function-1.png"
tags: ["Webshell", "セキュリティ", "PHP", "create_function", "Web攻撃", "脆弱性分析"]
---

## Webshell(ウェブシェル)の概要

Webshell(ウェブシェル)は、Webサーバーにアップロードされた悪意のあるスクリプトで、攻撃者がサーバーをリモートで制御できるようにします。  
これにより、サーバーのファイルシステムにアクセスし、コマンドを実行することが可能です。

### 主な機能
- **ファイル管理:** アップロード、ダウンロード、修正、削除  
- **コマンド実行:** サーバーでのシェルコマンド実行  
- **ネットワーク活動:** マルウェアの拡散およびシステム攻撃  
- **データベースアクセス:** 機密情報の流出  

<!--more-->
![webshell_attack_and_create_function](https://blog.plura.io/cdn/column/webshell_attack_and_create_function-1.png)

---

## Webshellの実行/分析情報

![1](https://github.com/user-attachments/assets/d1b54924-32cc-41d0-a570-ffc3a192e64f)

### 分析情報
- **MD5:** `3cd5c4352b1379bd789ab3de7b76a196`  
- **SHA-1:** `3a728d71ac418a906f9db78ba3fa935736eb02c9`  
- **SHA-256:** `ec04ce68129b58837f0b7b720f9dcb453d840f051ef9d1e2f7d197abf4167384`  

[写真 1] Virustotal Webshellの分析情報  

---

## create_function関数の脆弱性

![3](https://github.com/user-attachments/assets/e3da1cf0-5ecc-4947-88e7-f1f50d917a86)

**create_function関数**は、PHPで無名関数(Anonymous Function)を生成する機能を提供します。  
しかし、セキュリティ上の脆弱性が原因で使用が徐々に廃止され、最新のPHPバージョンでは完全に削除されました。

### PHPバージョン別の動作状況

1. **PHP 4.0.1 ~ 7.1.x**  
   - 正常に使用可能。  

2. **PHP 7.2.0 ~ 7.4.x**  
   - `create_function()`は非推奨(deprecated)となり、警告メッセージが表示されますが、実行は可能です。  
   - **出力例:**  
     ```plaintext
     Deprecated: Function create_function() is deprecated in /path/to/file.php on line 2
     ```

3. **PHP 8.0以上**  
   - 関数が完全に削除され、実行時にFatal Errorが発生します。  
   - **出力例:**  
     ```plaintext
     Fatal error: Uncaught Error: Call to undefined function create_function() in /path/to/file.php:2
     ```

---

## 対策

PHPのバージョンをアップデートすることは、セキュリティおよびパフォーマンスの向上に不可欠です。  
特に、create_function関数のセキュリティ脆弱性を防ぐために、最新のPHPバージョンを使用することが推奨されます。

### 最新バージョンアップデートのメリット
1. **セキュリティ強化:** Webshell攻撃および脆弱性の防止。  
2. **パフォーマンス向上:** Webアプリケーションの応答速度最適化。  
3. **新機能の提供:** 最新の構文と機能の活用が可能。  

PHP 8.0以上にアップデートすることで、セキュリティとパフォーマンスを維持し、Webshellのような攻撃からシステムを保護することができます。

---

## 参考資料

- [PHP公式ドキュメント - create_function関数](https://www.php.net/manual/en/function.create-function.php)  
- [Virustotal Webshell分析結果](https://www.virustotal.com/gui/file/ec04ce68129b58837f0b7b720f9dcb453d840f051ef9d1e2f7d197abf4167384/details)  
