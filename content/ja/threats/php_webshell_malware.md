---
date: 2021-05-12T00:03:00
draft: false
title: "PHP WEBSHELL マルウェア"
description: 
featured_image: "cdn/threats/php_webshell_malware-1.png"
tags: ["WEBSHELL", "PHP マルウェア", "ウェブハッキング", "セキュリティ脆弱性", "PLURA"]
---

### WEBSHELLとは？
ウェブサーバーのアップロード脆弱性を利用してシステムにコマンドを送信できるコードのことを指します。  
簡単なサーバースクリプト（JSP, PHP, ASP ...）で作成する方法が広く利用されています¹⁾

<!--more-->

Microsoftの検出および対応チームによると、Webshell攻撃は2020年に比べ2021年に2倍増加しており、世界的に継続的な脅威となっている攻撃です²⁾

![php_webshell_malware](https://blog.plura.io/cdn/threats/php_webshell_malware-1.png)

次のスクリーンショットは最近PLURAで検出されたマルウェアです。

| ![1 (1)](https://github.com/user-attachments/assets/1df3a84e-5fcc-48ff-9229-0c4a7a9ea54d) |
|:--:|
| [画像 1] WEBSHELL>FILE EXECUTION - 危険性の高い関数呼び出しの検出 |

このマルウェアはGETメソッドでPHPコードを送信しようとし、主要データはbase64でエンコードされました。  
デコードした結果、`http://.../rookie.php` ファイルを `./data/.../xmm.php` にコピーして出力することがわかりました。

*仮想環境でこのマルウェアをテスト実行*

| ![22](https://github.com/user-attachments/assets/7f263c6d-1c0f-495b-b51e-6c42ba607d4b) |
|:--:|
| [画像 2] `test.php` コード |

| ![2-3](https://github.com/user-attachments/assets/66104249-74ed-4817-8f12-bb28b345a420) |
|:--:|
| [画像 3] `test.php` 接続 |

| ![4 (1)](https://github.com/user-attachments/assets/06f4abc5-75fb-4313-b50b-c481bc813e0e) |
|:--:|
| [画像 4] 外部IPアドレスでのアウトバウンド行為 |

| ![5-1](https://github.com/user-attachments/assets/2912c085-8013-4bd5-a451-dd5c6bb3287f) |
|:--:|
| [画像 5] test2.php コード  
外部の `rookie.php` ファイルを内部に `test2.php` としてコピー |

| ![6](https://github.com/user-attachments/assets/f9bfae03-d992-48dc-a470-15836c3c3f10) |
|:--:|
| [画像 6] test2.php 接続 |

| ![7](https://github.com/user-attachments/assets/946b893f-32e5-45e1-a782-b7f9b08150ae) |
|:--:|
| [画像 7] test2.php Webshell 実行 |

幸い、発見された企業ではこのコードは実行されませんでした。  
しかし、もしこのような脆弱性が存在してWebshellのようなファイルがダウンロード・アップロードされ、実行されてしまうと、攻撃者は非常に簡単にシステムを掌握することができます。

**PLURAはWebshell攻撃の種類を分析し、自動で検出し、ブロックしています。**

## 参照
- [ウィキペディア, Webshell](https://ko.wikipedia.org/wiki/%EC%9B%B9_%EC%85%B8)
- [マイクロソフト, Webshell 攻撃の増加](https://www.microsoft.com/security/blog/2021/02/11/web-shell-attacks-continue-to-rise/)

## 動画
- Webshell ハッキングデモ : [https://youtu.be/BszuH4SoZUg?si=mdAoMVVcNuRxSUtZ](https://youtu.be/BszuH4SoZUg?si=mdAoMVVcNuRxSUtZ)
