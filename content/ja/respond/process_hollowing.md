---
date: 2025-02-10T16:00:00
draft: false
description: 
featured_image: "cdn/respond/process_hollowing.png"
tags: ["process_hollowing", "CyberSecurity", "MalwareAnalysis", "ThreatDetection", "EDR_Security"]
title: "Process Hollowing: æ”»æ’ƒæŠ€è¡“ã¨æ¤œå‡ºæˆ¦ç•¥"
---

# ğŸ¤”1. Process Hollowingã¨ã¯ï¼Ÿ

**Process Hollowing**ã¯ã€T1055.012ã¨ã—ã¦åˆ†é¡ã•ã‚Œã‚‹**Process Injection**ã®ã‚µãƒ–ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã§ã‚ã‚Šã€  
**æ­£è¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ç©ºé–“ã‚’ç ´æã•ã›ã€ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚’å®Ÿè¡Œã™ã‚‹æ‰‹æ³•**ã‚’æŒ‡ã—ã¾ã™ã€‚<br>
<br>
ğŸ•µï¸â€â™‚ï¸ ä¸»ã«**æ¨©é™æ˜‡æ ¼ã‚„æ¤œçŸ¥å›é¿**ã‚’ç›®çš„ã¨ã—ã¦ä½¿ç”¨ã•ã‚Œã€ä»£è¡¨çš„ãªä¾‹ã¨ã—ã¦**Meterpreter**ã‚„**Cobalt Strike**ãªã©ã®æ”»æ’ƒãƒ„ãƒ¼ãƒ«ã§æ´»ç”¨ã•ã‚Œã¾ã™ã€‚<br>
æ”»æ’ƒè€…ã¯ã€æ­£è¦ã®å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã—ãŸå¾Œã€ãã®ãƒ¡ãƒ¢ãƒªå†…ã®ã‚³ãƒ¼ãƒ‰ã‚’**æ‚ªæ„ã®ã‚ã‚‹ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã«ä¸Šæ›¸ã**ã™ã‚‹ã“ã¨ã§å‹•ä½œã—ã¾ã™ã€‚

ã“ã®æ‰‹æ³•ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚ˆã£ã¦æ¤œçŸ¥ã•ã‚Œã«ãã„ã§ã™ã€‚<br>
ğŸš¨ ãªãœãªã‚‰ã€å®Ÿè¡Œä¸­ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒ**æ­£è¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒã˜ãƒ‘ã‚¹ã‚’æŒã¡ã€ç½²åã•ã‚ŒãŸåˆæ³•çš„ãªãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«è¦‹ãˆã‚‹**ãŸã‚ã§ã™ã€‚  

<!--more-->

![process_hollowing1](https://github.com/user-attachments/assets/524b4574-0aa7-4878-abc2-60694b47cf9e)

[å†™çœŸ 1] Process Hollowing

# ğŸ› ï¸2. Process Hollowingã®ä¸»è¦ãªæ‰‹é †

Process Hollowingã¯ã€ä¸€èˆ¬çš„ã«ä»¥ä¸‹ã®æ‰‹é †ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

## 2-1) ãƒ—ãƒ­ã‚»ã‚¹ã‚’ä¸€æ™‚åœæ­¢çŠ¶æ…‹ã§ä½œæˆã™ã‚‹

![process_hollowing2](https://github.com/user-attachments/assets/011a705f-b35a-4612-8c46-d9a2e70025d5)

[å†™çœŸ 2] Process Hollowing Step 1

![code1-1-1](https://github.com/user-attachments/assets/2cf8151c-6d40-40ac-aaca-e8ba105eb9ba)

[å†™çœŸ 3] Process Hollowing Step 1 (code)

æ­£å¸¸ãªãƒ—ãƒ­ã‚»ã‚¹ã§ã‚ã‚‹**explorer.exe**ã‚’å®Ÿè¡Œã™ã‚‹ã€‚

## 2-2) ãƒ—ãƒ­ã‚»ã‚¹ã®ImageBaseã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã™ã‚‹ã€‚

![process_hollowing3](https://github.com/user-attachments/assets/2d2c9524-e112-4798-91ce-b5e1bd2779d0)

[å†™çœŸ 4] Process Hollowing Step 2

![code1-2-1](https://github.com/user-attachments/assets/33b8e5cb-e8b8-4e48-ae71-3e418adbf250)

[å†™çœŸ 5] Process Hollowing Step 2 (code)

æ–°ã—ãä½œæˆã•ã‚ŒãŸãƒ—ãƒ­ã‚»ã‚¹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã™ã‚‹ã€‚

## 2-3) ãƒ—ãƒ­ã‚»ã‚¹ã®ImageBaseã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’Unmappingã™ã‚‹ã€‚

![process_hollowing4](https://github.com/user-attachments/assets/2d798777-6958-451d-a874-ab5422780f4a)

[å†™çœŸ 6] Process Hollowing Step 3

![image](https://github.com/user-attachments/assets/87cf1b03-cd7f-4e1e-aad7-3861171d7fb5)

[å†™çœŸ 7] Process Hollowing Step 3 (code)

å…ƒã€…å®Ÿè¡Œã•ã‚Œã¦ã„ãŸ**explorer.exe**ã®ãƒ¡ãƒ¢ãƒªã‚’ã‚¢ãƒ³ãƒãƒƒãƒ—ã—ã€ç©ºã®çŠ¶æ…‹ã«ã™ã‚‹ã€‚

## 2-4) ãƒ—ãƒ­ã‚»ã‚¹ã®ImageBaseã‚¢ãƒ‰ãƒ¬ã‚¹ã«æ–°ã—ã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã€‚

![process_hollowing5](https://github.com/user-attachments/assets/8c892aca-1789-44c7-ac72-d04f3c4d4e9c)

[ì‚¬ì§„ 8] Process Hollowing Step 4

![code2-1](https://github.com/user-attachments/assets/01677cfb-bee8-41ec-96ad-a13198237a8d)

[å†™çœŸ 9] Process Hollowing Step 4 (code1)

![code2-2](https://github.com/user-attachments/assets/9b99ed92-af05-498c-8e82-bddc06e1adad)

[å†™çœŸ 10] Process Hollowing Step 4 (code2)

- **injector**ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ç”¨ã—ã¦ã€**ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚³ãƒ¼ãƒ‰ï¼ˆmalwareTargetï¼‰**ã‚’æ­£è¦ãƒ—ãƒ­ã‚»ã‚¹ã«æ³¨å…¥ã™ã‚‹æº–å‚™ã‚’è¡Œã†ã€‚  
- **malwareTarget**ï¼ˆã‚µã‚¤ã‚º: 2,203,648ãƒã‚¤ãƒˆã®PEãƒã‚¤ãƒŠãƒªï¼‰ã‚’**peã‚¯ãƒ©ã‚¹**ã‚’ä½¿ç”¨ã—ã¦ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚  
- `injector.alloc(malwr_size, imagebase, false);`  
  - å…ƒã®ãƒ—ãƒ­ã‚»ã‚¹ãŒä½¿ç”¨ã—ã¦ã„ãŸé ˜åŸŸï¼ˆ**imagebase**ï¼‰ã«ã€ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚³ãƒ¼ãƒ‰ã®ã‚µã‚¤ã‚ºåˆ†ã®ãƒ¡ãƒ¢ãƒªã‚’å‰²ã‚Šå½“ã¦ã‚‹ã€‚

## 2-5) ä¸€æ™‚çš„ãªãƒ¡ãƒ¢ãƒªé ˜åŸŸã‚’ç¢ºä¿ã™ã‚‹ã€‚

![process_hollowing6](https://github.com/user-attachments/assets/1f85d2b0-c132-4098-8c2d-569a877a5ac1)

[å†™çœŸ 11] Process Hollowing Step 5

![code2-3](https://github.com/user-attachments/assets/2c1dff38-7497-458f-b1c1-bcbfd166ea83)

[å†™çœŸ 12] Process Hollowing Step 5 (code)

- **PEãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®æ–°ã—ã„ãƒ¡ãƒ¢ãƒªé ˜åŸŸ**ã‚’ç¢ºä¿ã™ã‚‹ã€‚  
- `getRelativeOffset` ã‚’ä½¿ç”¨ã—ã¦ã€**å†é…ç½®æƒ…å ±ï¼ˆRelocation Offsetï¼‰**ã‚’è¨ˆç®—ã™ã‚‹ã€‚  
- **æ–°ã—ã„ãƒ™ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚³ãƒ¼ãƒ‰ã«è¨­å®šã™ã‚‹**ã€‚

## 2-6) ä¸€æ™‚çš„ã«ç¢ºä¿ã—ãŸãƒ¡ãƒ¢ãƒªé ˜åŸŸã«ãƒãƒ«ã‚¦ã‚§ã‚¢PEãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æ›¸ãè¾¼ã‚€ã€‚

![process_hollowing7](https://github.com/user-attachments/assets/b490090d-752f-4bd6-9742-b1f111e42910)

[å†™çœŸ 13] Process Hollowing Step 6

![code2-4](https://github.com/user-attachments/assets/af1bb32e-2db0-480a-9223-5e14c6fa2c0a)

[å†™çœŸ 14] Process Hollowing Step 6 (code)

ãƒ—ãƒ­ã‚»ã‚¹ãŒæ­£å¸¸ã«å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã€**PEãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆHeaderï¼‰æƒ…å ±**ã‚’æœ€åˆã«æ›¸ãè¾¼ã‚€ã€‚

## 2-7) ä¸€æ™‚çš„ã«ç¢ºä¿ã—ãŸãƒ¡ãƒ¢ãƒªé ˜åŸŸã«ãƒãƒ«ã‚¦ã‚§ã‚¢PEãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’æ›¸ãè¾¼ã‚€ã€‚

![process_hollowing8](https://github.com/user-attachments/assets/ed71f701-290c-4acb-a2de-f0ab19c7c7a9)

[å†™çœŸ 15] Process Hollowing Step 7

![code2-5](https://github.com/user-attachments/assets/b7823331-c03f-4ba6-a327-efb282ea4811)

[å†™çœŸ 16] Process Hollowing Step 7 (code)

- **PEãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆHeaderï¼‰+ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆSectionï¼‰æ§‹é€ **ã§æ§‹æˆã•ã‚Œã¦ã„ã‚‹ã€‚  
- `getFirstSection()` ã‚’ä½¿ç”¨ã—ã¦æœ€åˆã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–å¾—ã—ã€`writeSection()` ã‚’ç”¨ã„ã¦å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚  
- `getNextSection(currentSection)` ã‚’ä½¿ç”¨ã—ã¦ã€ã™ã¹ã¦ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é †ç•ªã«æ›¸ãè¾¼ã‚€ã€‚

## 2-8) ImageBaseã‚’åŸºæº–ã«ãƒãƒ«ã‚¦ã‚§ã‚¢PEãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ¼ãƒ‰ã¨ãƒ‡ãƒ¼ã‚¿ã‚’å†é…ç½®ã™ã‚‹ã€‚

![process_hollowing9](https://github.com/user-attachments/assets/27a5e07d-3a2c-49fb-b459-263691682c05)

[å†™çœŸ 17] Process Hollowing Step 8

![code2-6](https://github.com/user-attachments/assets/9d78b686-3c61-42a4-b477-50abbe3929c4)

[å†™çœŸ 18] Process Hollowing Step 8 (code)

- **PEãƒ•ã‚¡ã‚¤ãƒ«ãŒæ–°ã—ã„ãƒ¡ãƒ¢ãƒªã‚¢ãƒ‰ãƒ¬ã‚¹ã«ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãŸã‚ã€å…ƒã€…æƒ³å®šã•ã‚Œã¦ã„ãŸãƒ™ãƒ¼ã‚¹ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ç•°ãªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹**ã€‚  
- `relocate()` é–¢æ•°ã‚’ä½¿ç”¨ã—ã€ç›¸å¯¾ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’é©ç”¨ã™ã‚‹ã“ã¨ã§ã€æ­£ã—ãå®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ä¿®æ­£ã™ã‚‹ã€‚

## 2-9) å†é…ç½®ãŒå®Œäº†ã—ãŸãƒãƒ«ã‚¦ã‚§ã‚¢PEãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ­£è¦PEãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ¡ãƒ¢ãƒªé ˜åŸŸã«æ›¸ãè¾¼ã‚€ã€‚

![process_hollowing10](https://github.com/user-attachments/assets/e1b11d53-6e2d-4c9b-8324-5c49c7646981)

[å†™çœŸ 19] Process Hollowing Step 9

![code2-7](https://github.com/user-attachments/assets/68a188f1-ea00-40ff-8421-40d72b52e7ba)

[å†™çœŸ 20] Process Hollowing Step 9 (code1)

![code3-1](https://github.com/user-attachments/assets/d45f46f2-bdf1-4f66-891a-7fa2f7c5d3fe)

[å†™çœŸ 21] Process Hollowing Step 9 (code2)

- `injector.write()` ã‚’ä½¿ç”¨ã—ã¦ã€**PEãƒ•ã‚¡ã‚¤ãƒ«å…¨ä½“ã‚’æ­£è¦ãƒ—ãƒ­ã‚»ã‚¹ã®ãƒ¡ãƒ¢ãƒªã«æ›¸ãè¾¼ã‚€**ã€‚  
- `patchEntryPoint()` ã‚’ä½¿ç”¨ã—ã¦ã€**å…ƒã®ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã‚’ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚³ãƒ¼ãƒ‰ã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆEntry Pointï¼‰ã«å¤‰æ›´ã™ã‚‹**ã€‚

## 2-10) ã‚³ãƒ¼ãƒ‰ã®é–‹å§‹ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ImageBaseã‚’åŸºæº–ã«ä¿®æ­£ã—ãŸå¾Œã€ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†é–‹ã™ã‚‹ã€‚

![process_hollowing11](https://github.com/user-attachments/assets/d2695498-3cab-4993-8754-bf19d1310143)

[å†™çœŸ 22] Process Hollowing Step 10

![code3-2](https://github.com/user-attachments/assets/843278b8-1037-477a-bac9-a2f18285d4b9)

[å†™çœŸ 23] Process Hollowing Step 10 (code)

- `resume()` ã‚’å‘¼ã³å‡ºã—ã€åœæ­¢çŠ¶æ…‹ã ã£ãŸãƒ—ãƒ­ã‚»ã‚¹ã‚’å†å®Ÿè¡Œã™ã‚‹ã€‚  
- ã—ã‹ã—ã€ã“ã®æ™‚ç‚¹ã‹ã‚‰å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã¯ã€**å…ƒã®explorer.exeã§ã¯ãªãã€ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚³ãƒ¼ãƒ‰**ã¨ãªã‚‹ã€‚

## Process Hollowingã®æ‰‹é †ã¾ã¨ã‚

1. **æ­£è¦ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆexplorer.exeï¼‰ã‚’å®Ÿè¡Œ**
2. **æ—¢å­˜ã®PEã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã‚¢ãƒ³ãƒãƒƒãƒ—ã—ã¦å‰Šé™¤**
3. **ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚³ãƒ¼ãƒ‰æ³¨å…¥ã®ãŸã‚ã®ãƒ¡ãƒ¢ãƒªå‰²ã‚Šå½“ã¦**
4. **PEãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ­ãƒ¼ãƒ‰ã—ã€ãƒ˜ãƒƒãƒ€ãƒ¼ï¼†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼**
5. **å†é…ç½®ï¼ˆRelocationï¼‰ã‚’é©ç”¨**
6. **ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆï¼ˆEntry Pointï¼‰ã‚’å¤‰æ›´**
7. **ãƒ—ãƒ­ã‚»ã‚¹ã‚’å†é–‹ â†’ æ­£è¦ãƒ—ãƒ­ã‚»ã‚¹ã«å½è£…ã—ã¦å®Ÿè¡Œ**

![hollow_test_virustotal](https://github.com/user-attachments/assets/d0eaebf5-9319-4066-8612-48101f02d7dd)

[å†™çœŸ 24] ä½¿ç”¨ã•ã‚ŒãŸ**hollow_test.exe**ã‚’VirusTotalã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸçµæœã€**23/71ã®ã‚¨ãƒ³ã‚¸ãƒ³ã§ãƒãƒ«ã‚¦ã‚§ã‚¢ã¨ã—ã¦æ¤œå‡º**ã€‚

## **ä½¿ç”¨ã•ã‚ŒãŸProcess Hollowingã‚³ãƒ¼ãƒ‰**

```cpp
#include <Windows.h>

#include "process_.h"
#include "injector.h"

#include "pe.h"

WCHAR wszProcessPath[] = L"explorer.exe";

unsigned char malwareTarget[2203648] = { // explorer.exeã®ãƒã‚¤ãƒŠãƒªå€¤ }
int WINAPI WinMain(
	HINSTANCE hInstance,
	HINSTANCE hPrevInstance,
	PSTR lpCmdLine,
	INT nCmdShow
)
{
	process normalProcess;

	if (normalProcess.create(wszProcessPath, true, false))
	{
		ULONG_PTR imagebase = normalProcess.imagebase();

		if (normalProcess.unmap(imagebase, false)) // Step3
		{
			injector injector(normalProcess.handle());

			pe malwr(malwareTarget, 2203648);
			ULONG malwr_size = malwr.imageSize();

			LONG_PTR relativeOffset = 0;

			ULONG_PTR malwrAddr = injector.alloc(malwr_size, imagebase, false); // Step4: target process ãƒ¡ãƒ¢ãƒªå‰²ã‚Šå½“ã¦

			if (malwrAddr != 0)
			{
				ULONG_PTR buildAddr = malwr.memAlloc(malwr_size); // Step5

				relativeOffset = malwr.getRelativeOffset(malwrAddr);
				malwr.setImagebase(malwrAddr);

				injector.writeHeader(buildAddr, (ULONG_PTR)malwr.peHeader(), malwr.peHeaderSize()); // Step6: ### ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¨˜éŒ²

				// Step 7
				ULONG_PTR currentSection = malwr.getFirstSection();

				for (int nSection = 0; nSection < malwr.numberOfSection(); ++nSection)
				{
					injector.writeSection(buildAddr, (ULONG_PTR)malwr.peHeader(), currentSection);
					currentSection = malwr.getNextSection(currentSection);
				}

				// Step 8: relocate
				malwr.relocate(buildAddr, relativeOffset);

				// Step 9, 10
				injector.write(malwrAddr, buildAddr, malwr_size, false);
				normalProcess.patchEntryPoint(malwrAddr, malwr.addressOfEntryPoint());
				normalProcess.resume();
			}
		}
	}

	return 0;
}

```

---

---

# 3. ä½œæˆã—ãŸProcess Hollowingãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å®Ÿè¡Œç”»é¢

![program](https://github.com/user-attachments/assets/57fff65a-d408-4b87-8c31-391668b18810)

[å†™çœŸ 25] **hollow_test.exe** å®Ÿè¡Œç”»é¢

![process_list](https://github.com/user-attachments/assets/79ba792b-8559-4b0b-80c7-b22789f208d2)

[å†™çœŸ 26] **ãƒ—ãƒ­ã‚»ã‚¹ä¸€è¦§**

Process Hackerã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ­ã‚»ã‚¹ã®ä¸€è¦§ã‚’ç¢ºèªã—ãŸçµæœã€`hollow_test.exe` ãƒ—ãƒ­ã‚»ã‚¹ã®ä¸‹ã«  
`explorer.exeï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ï¼‰` ãŠã‚ˆã³ `conhost.exe` ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã§ããŸã€‚

## ğŸ” ãƒ—ãƒ­ã‚»ã‚¹åˆ†æ

### a. **`hollow_test.exe` å†…éƒ¨ã§åˆ¥ã® `explorer.exe` ãŒå®Ÿè¡Œ**
- æœ¬æ¥ã€`explorer.exe` ã¯ã‚·ã‚¹ãƒ†ãƒ ã«ã‚ˆã£ã¦è‡ªå‹•çš„ã«å®Ÿè¡Œã•ã‚Œã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã ãŒã€  
  ç‰¹å®šã®å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`hollow_test.exe`ï¼‰ãŒè¦ªãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ `explorer.exe` ã‚’å®Ÿè¡Œã—ãŸã“ã¨ã¯éå¸¸ã«ç–‘ã‚ã—ã„å‹•ä½œã§ã‚ã‚‹ã€‚
- ã“ã‚Œã¯é€šå¸¸ã®å®Ÿè¡Œæ–¹å¼ã§ã¯ãªãã€ãƒãƒ«ã‚¦ã‚§ã‚¢ãŒ**Hollowingæ‰‹æ³•ã‚’åˆ©ç”¨ã—ã¦æ­£è¦ãƒ—ãƒ­ã‚»ã‚¹ã‚’å½è£…ã—ãŸå¯èƒ½æ€§**ã‚’ç¤ºå”†ã—ã¦ã„ã‚‹ã€‚

### b. **`conhost.exe` ã®å­˜åœ¨**
- `conhost.exe` ã¯ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹**æ­£è¦ã®Windowsãƒ—ãƒ­ã‚»ã‚¹**ã ãŒã€  
  `hollow_test.exe` ã®é…ä¸‹ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ç‚¹ãŒç‰¹ç•°ã§ã‚ã‚‹ã€‚
- ãƒãƒ«ã‚¦ã‚§ã‚¢ãŒ `conhost.exe` ã‚’åˆ©ç”¨ã—ã¦ã‚·ã‚§ãƒ«ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚‹ãŸã‚ã€æ³¨æ„ãŒå¿…è¦ã€‚

### c. **CPUãŠã‚ˆã³ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®åˆ†æ**
- `hollow_test.exe` ã®**CPUä½¿ç”¨ç‡ãŒé«˜ããªã„å ´åˆã€ãƒãƒ«ã‚¦ã‚§ã‚¢ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§é™ã‹ã«å‹•ä½œã—ã¦ã„ã‚‹å¯èƒ½æ€§**ãŒã‚ã‚‹ã€‚
- `WriteProcessMemory`ã€`SetThreadContext`ã€`ResumeThread` ãªã©ã®APIå‘¼ã³å‡ºã—ã‚’ç›£è¦–ã—ã€  
  **è¿½åŠ ã®HollowingãŒç™ºç”Ÿã—ã¦ã„ãªã„ã‹**ã‚’ç¢ºèªã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚

![two_explorer](https://github.com/user-attachments/assets/fc3de4a3-034e-47b3-af0b-f2a8c488f52d)

[å†™çœŸ 27] **`explorer.exe` ãƒ—ãƒ­ã‚»ã‚¹ãŒ2ã¤å­˜åœ¨ã™ã‚‹ã“ã¨ã‚’ç¢ºèª**

## 1ï¸âƒ£ åˆ†æãƒã‚¤ãƒ³ãƒˆ

### 1) `explorer.exe` ãƒ—ãƒ­ã‚»ã‚¹ãŒ2ã¤å­˜åœ¨

- Windowsã§ã¯é€šå¸¸ã€**1ã¤ã® `explorer.exe`** ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚
- `explorer.exe` ãŒè¤‡æ•°å­˜åœ¨ã™ã‚‹å ´åˆã€**ãƒãƒ«ã‚¦ã‚§ã‚¢ãŒHollowingæ‰‹æ³•ã‚’ä½¿ç”¨ã—ãŸå¯èƒ½æ€§**ãŒã‚ã‚‹ã€‚

### 2) Parent-Childé–¢ä¿‚ãŠã‚ˆã³ãƒ—ãƒ­ã‚»ã‚¹ç”Ÿæˆã®ç¢ºèª

- ä¸Šè¨˜ã®ç”»åƒã§ã¯ã€**PID 9728** ã® `explorer.exe` ãŒ **PID 2296** ã® `explorer.exe` ã® **å­ãƒ—ãƒ­ã‚»ã‚¹** ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã€‚
- `explorer.exe` ãŒåˆ¥ã® `explorer.exe` ã®**å­ãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦ç”Ÿæˆã•ã‚Œã‚‹ã®ã¯é€šå¸¸ã®å‹•ä½œã§ã¯ãªã„**ã€‚
- ã“ã‚Œã¯ã€æ”»æ’ƒè€…ãŒæ­£è¦ã® `explorer.exe` ã‚’ Hollowing ã—ã¦å®Ÿè¡Œã—ãŸå¯èƒ½æ€§ãŒé«˜ã„ã€‚

### 3) ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã¨å®Ÿè¡Œã‚µã‚¤ã‚ºã®å·®ç•°

- **PID 2296 (`explorer.exe`)**: 86.25MB ãƒ¡ãƒ¢ãƒªä½¿ç”¨
- **PID 9728 (`explorer.exe`)**: 5.05MB ãƒ¡ãƒ¢ãƒªä½¿ç”¨
- é€šå¸¸ã€`explorer.exe` ã¯å¤šãã®ãƒ¡ãƒ¢ãƒªã‚’æ¶ˆè²»ã™ã‚‹ãŒã€**5.05MBã—ã‹ä½¿ç”¨ã—ã¦ã„ãªã„** `explorer.exe` ã¯ã€  
  **Hollowingã«ã‚ˆã£ã¦æ­£è¦ã®PEãŒãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§**ãŒé«˜ã„ã€‚

![explorer_analysis](https://github.com/user-attachments/assets/877a4d15-49de-44f9-9204-7bedb1c5762d)

[å†™çœŸ 28] **2ã¤ã® `explorer.exe` ãƒ—ãƒ­ã‚»ã‚¹åˆ†æ**

## **1ï¸âƒ£ åˆ†æãƒã‚¤ãƒ³ãƒˆ**

### **âœ… (1) æ­£å¸¸ãª `explorer.exe` (PID 2296)**

- **ãƒ‘ã‚¹:** `C:\Windows\Explorer.EXE`ï¼ˆæ­£è¦ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ï¼‰
- **å®Ÿè¡Œå ´æ‰€:** `C:\Windows\system32\`
- **å®Ÿè¡Œé–‹å§‹:** **3ã‹æœˆå‰ (2024-10-30)**  
  â†’ æ­£å¸¸ãª `explorer.exe` ã¯é€šå¸¸ Windows èµ·å‹•æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ãŸã‚ã€**é•·æ™‚é–“å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã®ãŒæ­£å¸¸**ã€‚
- **è¦ªãƒ—ãƒ­ã‚»ã‚¹:** `Non-existent process (PID 4088)`  
  â†’ `explorer.exe` ã¯é€šå¸¸ `winlogon.exe` ã«ã‚ˆã£ã¦èµ·å‹•ã•ã‚Œã‚‹ãŸã‚ã€**è¦ªãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã—ãªã„ã®ã¯æ­£å¸¸ãªå ´åˆãŒå¤šã„**ã€‚

### **ğŸš¨ (2) ç–‘ã‚ã—ã„ `explorer.exe` (PID 9728)**

- **ãƒ‘ã‚¹:** `C:\Windows\explorer.exe`ï¼ˆæ­£è¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚ˆã†ã«è¦‹ãˆã‚‹ãŒã€å®Ÿè¡Œæ–¹æ³•ãŒç•°ãªã‚‹ï¼‰
- **å®Ÿè¡Œå ´æ‰€:** `C:\Users\user\Desktop\hollow_test\x64\Debug\`  
  â†’ â— **æ­£è¦ã® `explorer.exe` ã¯ `system32` ã§å®Ÿè¡Œã•ã‚Œã‚‹ã¹ãã ãŒã€ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ä¸Šã® `hollow_test.exe` ã«ã‚ˆã£ã¦å®Ÿè¡Œã•ã‚ŒãŸã€‚**
- **å®Ÿè¡Œé–‹å§‹:** **3æ—¥20æ™‚é–“å‰ (2025-02-05)**  
  â†’ ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ã¨ã¯ç„¡é–¢ä¿‚ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§æ–°ã—ã `explorer.exe` ãŒå®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã€‚
- **è¦ªãƒ—ãƒ­ã‚»ã‚¹:** `hollow_test.exe (PID 2196)`  
  â†’ â— `explorer.exe` ã¯é€šå¸¸ `winlogon.exe` ã«ã‚ˆã£ã¦èµ·å‹•ã•ã‚Œã‚‹ãŒã€**åˆ¥ã®ãƒ—ãƒ­ã‚»ã‚¹ (`hollow_test.exe`) ãŒè¦ªãƒ—ãƒ­ã‚»ã‚¹ã¨ã—ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹ã€‚**  
  â†’ **Process Hollowing** æ”»æ’ƒæ‰‹æ³•ã§ã‚ˆãè¦‹ã‚‰ã‚Œã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚ã‚‹ã€‚
  
---

## **2ï¸âƒ£ Process Hollowing ã®ç–‘ã‚ã—ã„è¨¼æ‹ **

ğŸ“Œ **Hollowing ã®å¯èƒ½æ€§ãŒé«˜ã„ç†ç”±:**

- **`hollow_test.exe` ãŒ Parent Process ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹**  
  â†’ ã“ã‚Œã¯é€šå¸¸ã® `explorer.exe` ã®å®Ÿè¡Œæ–¹å¼ã¨ã¯ç•°ãªã‚‹ã€‚

- **`explorer.exe` ãŒç•°å¸¸ãªãƒ‘ã‚¹ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã® Debug ãƒ•ã‚©ãƒ«ãƒ€ï¼‰ã‹ã‚‰å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹**  
  â†’ é€šå¸¸ã® `explorer.exe` ã¯ `C:\Windows\system32\` ã‹ã‚‰å®Ÿè¡Œã•ã‚Œã‚‹ã¹ãã ãŒã€  
    **åˆ¥ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰èµ·å‹•ã•ã‚Œã¦ã„ã‚‹ç‚¹ãŒä¸å¯©**ã€‚

- **`explorer.exe` ã®å®Ÿè¡Œæ™‚é–“ãŒ3æ—¥å‰ã§ã€æ‰‹å‹•ã§å®Ÿè¡Œã•ã‚ŒãŸå¯èƒ½æ€§**  
  â†’ **Windows ã®èµ·å‹•ãƒ—ãƒ­ã‚»ã‚¹ã¨ã¯ç„¡é–¢ä¿‚ãªå®Ÿè¡Œå±¥æ­´**ãŒã‚ã‚Šã€ä¸æ­£ãªãƒ—ãƒ­ã‚»ã‚¹æ³¨å…¥ã®ç–‘ã„ãŒå¼·ã„ã€‚

![analsys](https://github.com/user-attachments/assets/2e9ee03c-fe88-4dde-bb0b-7ffa345042b5)

[å†™çœŸ 29] **2ã¤ã® `explorer.exe` ãƒ—ãƒ­ã‚»ã‚¹åˆ†æ**

## **1ï¸âƒ£ ã‚¹ãƒ¬ãƒƒãƒ‰ï¼ˆThreadï¼‰åˆ†æãƒã‚¤ãƒ³ãƒˆ**

### **âœ… (1) æ­£å¸¸ãª `explorer.exe` (PID 2296)**

- **TIDï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰IDï¼‰ã®æ•°:** 13å€‹ä»¥ä¸Šã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒå®Ÿè¡Œä¸­ã€‚
- **Start Addressï¼ˆé–‹å§‹ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰:**
    - `SHCore.dll!Ordinal172+0x100`ï¼ˆWindows Shell é–¢é€£ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰
    - `ntdll.dll!TpReleaseCleanupGroupMembers`ï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«é–¢é€£ï¼‰
    - `combase.dll!RoGetServerActivatableClassRegistration`ï¼ˆCOM ãƒ™ãƒ¼ã‚¹ã‚µãƒ¼ãƒ“ã‚¹é–¢é€£ï¼‰
    - `WorkFoldersShell.dll!DllUnregisterServer`ï¼ˆWorkFolders é–¢é€£ãƒ—ãƒ­ã‚»ã‚¹ï¼‰
    - ãã®ä»–ã€`GdiPlus.dll`ã€`SHCore.dll` ãªã©ã®ã‚·ã‚¹ãƒ†ãƒ  DLL ã‹ã‚‰é–‹å§‹ã•ã‚Œã‚‹**æ­£å¸¸ãªå‹•ä½œ**ãŒç¢ºèªã•ã‚Œã‚‹ã€‚
- **ã‚¹ãƒ¬ãƒƒãƒ‰å„ªå…ˆåº¦:** `Above normal` ã‚’å«ã‚€ã€ã•ã¾ã–ã¾ãªå„ªå…ˆåº¦ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒå­˜åœ¨ã€‚
- **è§£æçµæœ:**
    - æ­£å¸¸ãª `explorer.exe` ã¯ **Windows ã®ã•ã¾ã–ã¾ãªã‚·ã‚¹ãƒ†ãƒ æ©Ÿèƒ½ã‚’åˆ©ç”¨ã—ã€å¤šæ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ç”Ÿæˆ**ã—ã¦å‹•ä½œã™ã‚‹ã€‚
    - ã“ã‚Œã¯ **Windows Shell ãŠã‚ˆã³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã®æ­£å¸¸ãªãƒ—ãƒ­ã‚»ã‚¹å‹•ä½œ**ã§ã‚ã‚‹ã€‚

---

### **ğŸš¨ (2) ç–‘ã‚ã—ã„ `explorer.exe` (PID 9728)**

- **TIDï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰IDï¼‰ã®æ•°:** **4å€‹ã®ã¿ã§éå¸¸ã«å°‘ãªã„**
- **Start Addressï¼ˆé–‹å§‹ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼‰:**
    - `explorer.exe+0xa3a10` â†’ â— **ãƒã‚¤ãƒŠãƒªã‚³ãƒ¼ãƒ‰ã‹ã‚‰ç›´æ¥å®Ÿè¡Œã•ã‚ŒãŸã‚¹ãƒ¬ãƒƒãƒ‰**ï¼ˆç–‘ã‚ã—ã„ï¼‰
    - `ntdll.dll!TpReleaseCleanupGroupMembers`ï¼ˆä¸€èˆ¬çš„ãªWindows APIï¼‰
- **ã‚¹ãƒ¬ãƒƒãƒ‰å„ªå…ˆåº¦:** ã™ã¹ã¦ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒ `Normal` ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ã€‚
- **è§£æçµæœ:**
    - **æ­£å¸¸ãª `explorer.exe` ã¨æ¯”è¼ƒã™ã‚‹ã¨ã€DLL ãƒ™ãƒ¼ã‚¹ã®ã‚¹ãƒ¬ãƒƒãƒ‰ãŒã»ã¨ã‚“ã©å­˜åœ¨ã—ãªã„ã€‚**
    - `ntdll.dll` ã® `TpReleaseCleanupGroupMembers` ã¯é€šå¸¸ã®å‹•ä½œã§ã‚ã‚‹å¯èƒ½æ€§ã¯ã‚ã‚‹ãŒã€  
      **å˜ä¸€ã®APIå‘¼ã³å‡ºã—ã®ã¿ã§ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ãŒå‹•ä½œã™ã‚‹ã®ã¯ä¸è‡ªç„¶**ã€‚
    - **æœ€ã‚‚ç–‘ã‚ã—ã„ç‚¹ã¯ `explorer.exe+0xa3a10` ã®ã‚¢ãƒ‰ãƒ¬ã‚¹ã‹ã‚‰ç›´æ¥å®Ÿè¡Œã•ã‚ŒãŸã‚¹ãƒ¬ãƒƒãƒ‰ãŒå­˜åœ¨ã™ã‚‹ã“ã¨ã€‚**
        - ã“ã‚Œã¯ **Process Hollowing ã«ã‚ˆã£ã¦ãƒãƒ«ã‚¦ã‚§ã‚¢ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãŒã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã•ã‚ŒãŸéš›ã«ã‚ˆãè¦‹ã‚‰ã‚Œã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³**ã€‚

---

## **2ï¸âƒ£ Process Hollowing ã®å¯èƒ½æ€§ãŠã‚ˆã³è¿½åŠ åˆ†æã®å¿…è¦æ€§**

ğŸ“Œ **Hollowing ã®å¯èƒ½æ€§ãŒé«˜ã„ç†ç”±:**

### a. **TIDï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰IDï¼‰æ•°ã®é•ã„**
   - **æ­£å¸¸ãª `explorer.exe`ï¼ˆPID 2296ï¼‰** ã¯ **13å€‹ä»¥ä¸Šã®ã•ã¾ã–ã¾ãªã‚·ã‚¹ãƒ†ãƒ ã‚¹ãƒ¬ãƒƒãƒ‰** ã‚’å«ã‚€ã€‚
   - **ç–‘ã‚ã—ã„ `explorer.exe`ï¼ˆPID 9728ï¼‰** ã¯ **4å€‹ã®ã¿ã§ã€å¤§éƒ¨åˆ†ãŒ `ntdll.dll` ã‹ã‚‰å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹**ã€‚

### b. **ç•°å¸¸ãªå®Ÿè¡Œå ´æ‰€**
   - `explorer.exe+0xa3a10` ã¯ã€æ˜ç¢ºãª DLL ãƒ™ãƒ¼ã‚¹ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã¯ãªãã€  
     **ãƒ¡ãƒ¢ãƒªå†…éƒ¨ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œå½¢æ…‹** ã«è¦‹ãˆã‚‹ãŸã‚ã€**Hollowingã®ç—•è·¡** ã¨ã—ã¦ç–‘ã‚ã—ã„ã€‚

### c. **è¦ªãƒ—ãƒ­ã‚»ã‚¹ (`hollow_test.exe`) ã®å­˜åœ¨**
   - **æœ¬æ¥ `explorer.exe` ã¯ `winlogon.exe` ã«ã‚ˆã£ã¦ç”Ÿæˆã•ã‚Œã‚‹ã¯ãš** ã ãŒã€  
     **ç•°å¸¸ãªãƒ—ãƒ­ã‚»ã‚¹ (`hollow_test.exe`) ã‹ã‚‰å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹** ã“ã¨ãŒç¢ºèªã•ã‚ŒãŸã€‚

---

ã“ã®ã‚ˆã†ã«ã€**Process Hollowing** æ‰‹æ³•ã¯è¡¨é¢çš„ã«ã¯æ­£è¦ãƒ—ãƒ­ã‚»ã‚¹ã¨åŒºåˆ¥ãŒé›£ã—ãã€å˜ç´”ãªè­˜åˆ¥æ–¹æ³•ã ã‘ã§ã¯æ¤œå‡ºãŒå›°é›£ã§ã™ã€‚  
ãã®ãŸã‚ã€å®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã®è©³ç´°ãªåˆ†æã‚„ãƒ¡ãƒ¢ãƒªæ¤œæŸ»ã€ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¯”è¼ƒãªã©ã€**é«˜åº¦ãªãƒ•ã‚©ãƒ¬ãƒ³ã‚¸ãƒƒã‚¯æŠ€è¡“**ãŒå¿…è¦ã¨ãªã‚Šã¾ã™ã€‚

# ğŸ”4. Process Hollowing ã®æ¤œå‡ºæ‰‹æ³•

Process Hollowing ã¯é«˜åº¦ãªæ”»æ’ƒæ‰‹æ³•ã§ã™ãŒã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã•ã¾ã–ã¾ãªæ–¹æ³•ã§æ¤œå‡ºã§ãã¾ã™ã€‚

## ğŸ“¡4-1) APIå‘¼ã³å‡ºã—ã®ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

`CreateProcess`ã€`NtUnmapViewOfSection`ã€`VirtualAllocEx`ã€`WriteProcessMemory`ã€  
`SetThreadContext`ã€`ResumeThread` ãªã©ã®APIå‘¼ã³å‡ºã—ãŒé€£ç¶šã—ã¦ç™ºç”Ÿã™ã‚‹å ´åˆã€ç–‘ã‚ã—ã„å‹•ä½œã¨è¦‹ãªã™ã¹ãã§ã™ã€‚

- **EDRã‚„SIEMãƒ­ã‚°**ã‚’åˆ†æã—ã€ã“ã‚Œã‚‰ã®APIã®å‘¼ã³å‡ºã—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç›£è¦–ã™ã‚‹ã“ã¨ã§ã€ä¸å¯©ãªæŒ™å‹•ã‚’æ¤œå‡ºã§ãã¾ã™ã€‚

## ğŸ´â€â˜ ï¸4-2) å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ¡ãƒ¢ãƒªãƒãƒƒãƒ”ãƒ³ã‚°ã®æ¯”è¼ƒ

æ­£è¦ã®å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ¡ãƒ¢ãƒªä¸Šã§ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ãŒç•°ãªã‚‹å ´åˆã€Process Hollowing ãŒç™ºç”Ÿã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚

- **`SigCheck` ã‚’ä½¿ç”¨ã—ã¦ã€å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®ç½²åã¨æ•´åˆæ€§ã‚’æ¤œè¨¼**
- **`Volatility` ã‚’æ´»ç”¨ã—ã€ãƒ¡ãƒ¢ãƒªå†…ã®å®Ÿè¡Œä¸­ãƒ—ãƒ­ã‚»ã‚¹ã‚’åˆ†æã—ã€å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã¨ã®ä¸ä¸€è‡´ã‚’æ¤œå‡º**

## ğŸ§©4-3) Parent-Child ãƒ—ãƒ­ã‚»ã‚¹é–¢ä¿‚ã®åˆ†æ

æ”»æ’ƒè€…ãŒå…ƒã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ã—ã€æ–°ãŸãª Hollowing ã•ã‚ŒãŸãƒ—ãƒ­ã‚»ã‚¹ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€Parent-Child é–¢ä¿‚ãŒç•°å¸¸ã«å¤‰åŒ–ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

- ä¾‹ï¼š`explorer.exe` ã‹ã‚‰ `cmd.exe` ã‚’å®Ÿè¡Œã™ã‚‹ã®ã¯æ­£å¸¸ã§ã™ãŒã€`winlogon.exe` ã‹ã‚‰ `powershell.exe` ãŒå®Ÿè¡Œã•ã‚Œã‚‹å ´åˆã¯ç–‘ã‚ã—ã„ã€‚
- **`Sysmon` ã‚’ä½¿ç”¨ã—ã¦ Parent-Child é–¢ä¿‚ã‚’è¿½è·¡** ã™ã‚‹ã“ã¨ã§ã€ä¸å¯©ãªãƒ—ãƒ­ã‚»ã‚¹ã®å‹•ä½œã‚’æ¤œå‡ºã§ãã¾ã™ã€‚

## ğŸ“Š4-4) ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã®æ¤œå‡º

Process Hollowing ã®æœ¬è³ªã¯ã€**æ­£è¦ãƒ—ãƒ­ã‚»ã‚¹å†…ã«ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚³ãƒ¼ãƒ‰ã‚’æ³¨å…¥ã™ã‚‹ã“ã¨** ã§ã™ã€‚  
ã“ã‚Œã‚’æ¤œå‡ºã™ã‚‹ãŸã‚ã«ã¯ã€**ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚³ãƒ¼ãƒ‰é ˜åŸŸã‚’å®šæœŸçš„ã«ã‚¹ã‚­ãƒ£ãƒ³ã—ã€å®Ÿè¡Œå¯èƒ½ãªãƒ¡ãƒ¢ãƒªãƒšãƒ¼ã‚¸ãŒå¤‰æ›´ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª** ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- **`Mimikatz` ã‚„ `PE-Sieve` ã‚’ä½¿ç”¨ã—ã¦ã€ãƒ¡ãƒ¢ãƒªä¸Šã®ä¸å¯©ãªã‚³ãƒ¼ãƒ‰æŒ¿å…¥ã‚’æ¤œå‡º** ã§ãã¾ã™ã€‚

# ğŸ›¡ï¸5. Process Hollowing ã®å¯¾ç­–

Process Hollowing æ”»æ’ƒã‚’åŠ¹æœçš„ã«é˜²ãã«ã¯ã€ä»¥ä¸‹ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ã‚’é©ç”¨ã™ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚

## 5-1) **EDRãŠã‚ˆã³SIEMã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®æ´»ç”¨**

- **APIå‘¼ã³å‡ºã—ã®ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ†æ**
- **å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯**
- **Parent-Childé–¢ä¿‚ã®ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°** ãªã©ã‚’è‡ªå‹•åŒ–ã—ã€æ”»æ’ƒã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ¤œå‡º

## 5-2) **æ”»æ’ƒå¯¾è±¡é ˜åŸŸã®æœ€å°åŒ–**

- `AppLocker` ã‚„ `Windows Defender Application Control (WDAC)` ã‚’æ´»ç”¨ã—ã€ç–‘ã‚ã—ã„å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã®å®Ÿè¡Œã‚’åˆ¶é™ã€‚
- **ASLRã€DEPã€CFG** ãªã©ã®ãƒ¡ãƒ¢ãƒªä¿è­·æŠ€è¡“ã‚’æœ‰åŠ¹ã«ã—ã€ã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã‚’å›°é›£ã«ã™ã‚‹ã€‚

## 5-3) **ã‚·ã‚¹ãƒ†ãƒ ãƒ­ã‚°åˆ†æãŠã‚ˆã³æ¤œå‡ºãƒ•ã‚£ãƒ«ã‚¿ã®é©ç”¨**

- **`Sysmon` ã‚„ `Windows Event Logging` ã‚’æ´»ç”¨ã—ã€ç–‘ã‚ã—ã„APIå‘¼ã³å‡ºã—ã‚’ç›£è¦–ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**

## 5-4) **å®šæœŸçš„ãªãƒ•ã‚©ãƒ¬ãƒ³ã‚¸ãƒƒã‚¯åˆ†æã®å®Ÿæ–½**

- **`Volatility`ã€`Procmon`ã€`PE-Sieve` ã‚’ä½¿ç”¨ã—ã¦ã‚·ã‚¹ãƒ†ãƒ ã‚’å®šæœŸçš„ã«ã‚¹ã‚­ãƒ£ãƒ³ã—ã€ä¸å¯©ãªå‹•ä½œã‚’åˆ†æ**

# ğŸ†6. çµè«–

Process Hollowing ã¯æ”»æ’ƒè€…ãŒé »ç¹ã«ä½¿ç”¨ã™ã‚‹å¼·åŠ›ãªã‚³ãƒ¼ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³æŠ€è¡“ã§ã™ãŒã€  
é©åˆ‡ãªæ¤œå‡ºæ‰‹æ³•ã‚’æ´»ç”¨ã™ã‚Œã°ã€ååˆ†ã«å¯¾ç­–ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚  
ç‰¹ã« **APIå‘¼ã³å‡ºã—ã®ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã€å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã¨ãƒ¡ãƒ¢ãƒªã®æ¯”è¼ƒã€Parent-Childé–¢ä¿‚ã®åˆ†æ** ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€æ”»æ’ƒã‚’åŠ¹æœçš„ã«æ¤œå‡ºã§ãã¾ã™ã€‚

ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ‹…å½“è€…ã¯å¸¸ã« **MITRE ATT&CK ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã® T1055ï¼ˆProcess Injectionï¼‰æŠ€è¡“ã‚’åˆ†æã—ã€æ¤œå‡ºãƒ•ã‚£ãƒ«ã‚¿ã‚’æœ€æ–°ã®çŠ¶æ…‹ã«ç¶­æŒ** ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  
ã¾ãŸã€å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨ãƒ•ã‚©ãƒ¬ãƒ³ã‚¸ãƒƒã‚¯åˆ†æã‚’é€šã˜ã¦ã€çµ„ç¹”ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ã‚’å¼·åŒ–ã™ã‚‹ã“ã¨ãŒæ±‚ã‚ã‚‰ã‚Œã¾ã™ã€‚
