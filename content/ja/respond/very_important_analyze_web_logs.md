---
date: 2025-02-20
draft: false
title: "Webの完全なログ分析はなぜ重要なのか?"
description: "ゼロデイ攻撃、クレデンシャルスタッフィング、ウェブシェル検出など、完全なウェブログ分析がなぜ重要なのかを学びます。"
featured_image: "cdn/column/very_important_analyze_web_logs.png"
tags: ["GET 方法", "POST 方法", "ウェブログ分析", "セキュリティ", "PLURA-XDR"]
---

🔍 近年、セキュリティ脅威はますます高度化し、複数のステップにわたって隠蔽された形で進行する攻撃手法が増加しています。単に特定のリクエスト（GET/POST）のみに焦点を当てるのではなく、ウェブ全体のトラフィックログを分析することで、より深く広範なセキュリティ情報を得ることができます。

本記事では、ゼロデイ攻撃、クレデンシャルスタッフィング、ウェブシェル検出、パラメータ改ざんといった事例だけでなく、全体的なウェブログ分析の重要性と、それを通じて得られるセキュリティの利点について考察します。

![Web Traffic](https://blog.plura.io/cdn/column/very_important_analyze_web_logs.png)  
<!--more-->

---

## なぜ全体的なウェブログ分析が重要なのか？

### 1) ゼロデイまたは未知の攻撃（Zero-Day Attack）検出 💥
既存の署名やルールベースのみでは検出が困難な**ゼロデイ（0-Day）攻撃**では、**全体的なウェブログ**を分析することで次のような利点があります：

- **異常兆候の分析**: 通常とは異なるトラフィックパターンや、特定のリソースに集中する不審なリクエストを早期発見  
- **複合的な攻撃の流れを把握**: 複数のステップを経て行われる新種の攻撃も追跡可能  

新しい攻撃に対応するためには、**異常パターンそのもの**を迅速に検出する能力が必須であり、これは**全体的なログ分析**を基盤にすることで可能になります。

### 2) 単一のパケットでは識別できない攻撃の特定 🔎
ウェブ攻撃は**複数回のリクエスト**を通じて実行されることがあります。代表的な例として**クレデンシャルスタッフィング（Credential Stuffing）**や**ブルートフォース（Brute Force）**があります。

- **単独のリクエスト**を見ると単なる「ログイン失敗」のように見えるが、  
- **全体的なログの推移**を分析すると、大量の認証試行や特定アカウントを狙った攻撃が検出可能  

このように、単なるエラーやログイン失敗が**短時間で多数発生しているか**、または**特定の時間帯に集中しているか**を総合的に判断することが重要です。

### 3) アップロードされたWebShellのパスを特定 🗂️
APT（Advanced Persistent Threat：高度持続型脅威）攻撃の初期段階でよく使用される手法の1つが**WebShellのアップロード**です。  
- ファイルアップロードリクエストのログ、サーバー内部のアクセスログを**連続的に**追跡  
- WebShellが実際にアップロードされたのか、その後どのスクリプトを実行したのかを確認  

このような**痕跡**を見逃さないためには、**ウェブログ全体**を詳細に監視する必要があります。

### 4) パラメータ改ざん攻撃（Parameter Tampering）✏️
ウェブアプリケーションの `クエリストリング`、`POST Body`、`クッキー`、`ヘッダー` などのパラメータを意図的に変更し、**異常な動作**を誘導する攻撃手法です。

- **価格改ざん、権限昇格、不正決済** などの直接的な被害につながる可能性が高い  
- パラメータ改ざんの過程で**異常に長い値や例外的な値**が繰り返し登場するパターンを全体的なログから発見可能  
- 特定のファイルアップロードパラメータ、管理者専用の機能パラメータなどを標的にするため、**全体的なトラフィック**の監視が必須  

攻撃者は通常のリクエストを装いながらパラメータをわずかに変更して送信するため、**単発のリクエスト**では単なる誤入力やエラーのように見える場合があります。しかし、**全体的なログ**を確認するとパターンが明らかになることが多いです。

### 5) セッションハイジャック（Session Hijacking）およびユーザー行動分析 🦹
ユーザーのセッションを盗み取り、権限を取得するセッションハイジャックは、**通常とは異なる行動パターン**や  
**セッションクッキーを使用した不正リクエストの繰り返し**などの形で現れます。

- **ログイン/ログアウトの間隔、ページ遷移パターン、User-Agent、IPの変化**を総合的に分析することで、正規ユーザーと攻撃者の行動を区別可能  
- これらのセッション情報も結局は**全体的なウェブログ**の中から多角的に調査する必要があるため、広範な分析が不可欠です。

### 6) 複合攻撃（マルチベクトル攻撃）への対応 🌐
- 攻撃者は**ウェブ + ホスト（サーバーおよびPC）**の両方で脆弱性を探ります。  
- 例えば、ウェブアプリケーションの脆弱性を探索した後、成功すると内部ホストへ侵入し、ラテラルムーブメント（水平移動攻撃）を試みます。  
- **ウェブログ全体**と**ホストのログ**を相互に関連付けて分析することで、攻撃の意図をより明確に把握できます。

### 7) ボット検出（Bot Detection）🤖
ウェブアプリケーションに**正常なユーザーではなく自動化されたプログラム**（クローラー、スクレイピングツール、悪意のあるボットなど）がアクセスし、  
異常なトラフィックを発生させたりデータを無断取得する行為が増えています。

- **不規則なUser-Agent**や未知のボット特有の文字列を使用  
- **短時間に数百・数千回のページリクエスト**を送り、特定リソースを執拗に取得  
- **IPや帯域を分散**して回避を試みる  

一見すると正規のトラフィックのように見える場合がありますが、**全体的なログ**のリクエストパターン（繰り返し・時間間隔・User-Agent）を確認すると、疑わしいボット活動が明らかになるケースが多いです。

### 8) コンテンツスクレイピング（Content Scraping）📰
競合サイトや悪意のある目的で**大量のページ**を取得する行為です。

- **短時間に多数のページ**をリクエストしたり、特定のリソースを集中的に取得するパターン  
- 著作権のあるテキスト・画像を無断でコピーし、**データベース化**するために攻撃的なスクレイピングを実施  
- サイトのパフォーマンス低下、サービスコストの増加などの間接的な被害を引き起こす  

攻撃者は正規ユーザーのようにアクセスするため、**個別のリクエスト**だけでは識別が難しいですが、**全体的なログ**で集中したリクエストパターンを確認すれば容易に特定できます。

### 9) DDoS前兆（Distributed Denial of Service）の事前検知 ⏰
特定のIPレンジや無作為なIPから**集中的に大量のリクエスト**が発生するパターンを特定します。

- 通常のトラフィック量と比較し、**異常な急増**があるか分析  
- **短時間で多数のリクエスト**が発生し、サーバーリソースを消費  
- APT攻撃の前段階として**トラフィック過負荷**を発生させ、セキュリティ機器やアプリケーションの障害を誘発することも  

**リアルタイムのログ**監視を通じてDDoSが開始される前に兆候を迅速に検出し、ファイアウォール・WAF設定を調整することで**被害を最小限に抑える**ことが可能です。

### 10) XSS、SQLインジェクションなど新たなウェブ脆弱性の試行 ⚠️
URLパラメータやPOST Body内に**スクリプトタグ**(`<script>`)や**SQL文**（SELECT、UNIONなど）が含まれるなど、  
さまざまな**ウェブ脆弱性攻撃のパターン**を試行する場合があります。

- **さまざまなエンコーディング**や**回避技術**（二重エンコーディング、特殊文字変換など）を組み合わせ、従来のフィルターを回避  
- 攻撃者が新規または変形されたペイロードを挿入し、XSS・SQLi・RCE（Remote Code Execution）などの類似攻撃を試行  
- **全体的なログ**で疑わしい文字列が繰り返し・集中して登場するかを分析し、検出  

新しい脆弱性が発見されると、セキュリティルールの更新前に攻撃が発生する可能性が高いため、**定期的な全体ログ分析**で兆候を見つける必要があります。

### 11) APIの不正利用（API Abuse）🚀
モバイルやサードパーティアプリケーションを通じて**異常なAPI呼び出し**が繰り返されるケースです。

- **レースコンディション攻撃**: 同じAPIを1秒間に数百回呼び出し、データ不整合やサーバーエラーを誘発  
- **大量リクエスト**によるサービス停止、リソース枯渇（例: メモリ、CPU）  
- 許可されていないデータや機能にアクセスし、**情報窃取**や**不正利用**を試行  

APIリクエストの特性上、**サーバーログやアプリケーションログに詳細が記録されない**場合もあるため、**別途収集**し、全体の状況を把握することが重要です。

### 12) ウェブサーバーエラー分析と障害原因の追跡 🩺
ウェブサーバーで発生する5xxエラー、アプリケーションのクラッシュログなどを**総合的に**分析します。

- **異常なリクエスト**や特定のパラメータが原因でアプリケーションが例外エラーを発生  
- **セキュリティ脆弱性**や**運用上の障害**が混在し、システムの可用性が低下  
- ログを通じて**エラー発生のタイミング**と**攻撃試行**を関連付け、原因を正確に特定  

セキュリティ問題と運用問題を同時に診断できるため、**全体的なロギング・モニタリングインフラ**が非常に重要です。

### 13) 攻撃ペイロードの回避手法検出（WAF Bypassの試行）👀
URLエンコーディング、二重エンコーディング、特殊文字変換などを活用し、**WAFやセキュリティソリューションの回避を試みるパターン**です。

- 既存ルールに引っかからないよう**特殊文字**を異なる形式に変換し、`script`を `scr\<ip\>t` のように分割  
- 正規のリクエストと混ぜて**意図的に小さなペイロード**を複数回送信する手法  
- **全体的なログ**で変換・エンコードされた文字列が繰り返し・集中して現れるかを監視  

このような回避手法は、**単発のリクエスト**では正当なアクセスに見えることが多いため、**総合的な全体ログ分析**が不可欠です。

### 14) 異常トラフィックの時間帯分析と動的防御ポリシーの作成 🕒
深夜や週末など**特定の時間帯**に急増する**疑わしいトラフィック**を事前に把握します。

- 一般ユーザーの活動が少ない時間帯に**集中攻撃**を仕掛け、検出・対応の遅延を狙う戦略  
- 該当時間帯に**同じIPレンジからのアクセスが繰り返されているか**を確認  
- **自動対応ポリシー**（IPブロック、トークン認証強化、CAPTCHA適用など）を動的に適用し、被害を最小限に  

異常トラフィックのパターンを**全体的なログ分析**で把握すれば、攻撃が発生する前に対処し、**事前防御**が可能になります。

---

## ✍️ 結論

単にGET/POSTのログのみを分けて確認するのではなく、**全体的なウェブログを総合的に分析することが、セキュリティ上非常に重要**です。

- **ゼロデイ攻撃などの新種の攻撃**を早期に特定し、  
- **クレデンシャルスタッフィング**のような多段階攻撃のパターンを把握し、  
- **WebShellアップロード**や**パラメータ改ざん**、**セッションハイジャック**といったAPTの初期段階を追跡し、  
- **マルチベクトル攻撃全般**、ボット検出・コンテンツスクレイピング・DDoS前兆・WAF回避攻撃などの**さまざまな脅威**に対応  

これはすべて、**ログを全体的に見て分析**したときに得られる重要なメリットです。

**特に、POSTリクエストのログに含まれるBodyデータの分析**が重要です。HTTP Body内に隠されたパラメータや悪意のあるペイロードを検出するには、  
単なるURL解析だけでは不十分であり、**POST Bodyを含めた全体的なログ**を収集・分析することが不可欠です。  
**POSTデータの監視を徹底**すれば、サーバーに直接アップロードされた悪意のあるファイルや、重要なパラメータが改ざんされる攻撃をより迅速に検出できます。

今日の攻撃者は、巧妙で複雑な手法を駆使してWebサーバーを狙っています。  
そのため、実際の運用環境でセキュリティ脅威を**先制的に**防ぐには、  
**GET/POSTを含むすべてのトラフィックログ**を**リアルタイム**または**準リアルタイム**で監視し、  
分析結果を基に迅速に対応できる環境を構築することが非常に重要です。  

---

### 📖 **参考資料**  
- [PLURA-Blog: 私たちはなぜGET/POSTログを分析するのか？](https://blog.plura.io/ja/column/why_analyze_get_post_logs/)
- [PLURA-Github: LoL（Living off the Land）攻撃の説明](https://github.com/qubitsec/plura/tree/main/demo/ja)  
