---
title: "AI 보조 WAF 우회: 가능성과 방어 전략 (심화)"
date: 2025-05-01
draft: false
description: "LLM/에이전트를 활용한 공격 페이로드 자동화·우회 시나리오를 방어 관점에서 구조화하고, TLS 브리징·정규화·양의 보안 모델·응답 DLP를 중심으로 실무형 대응 프레임을 제시합니다."
featured_image: "cdn/tech/ai-waf-bypass.png"
tags: ["AI보안", "WAF", "LLM", "SOAP", "XML", "DLP", "PLURA-XDR", "보안운영"]
---

# AI 보조 WAF 우회: 가능성과 방어 전략 (심화)

아래 문서는 **LLM/에이전트 기반의 우회 전술**을 **방어 측 시각**에서 해설합니다.  
※ 공격 재현·악성 페이로드 예시는 **포함하지 않습니다**(방어·검증용 가이드 전용).

---

## 0) Executive summary

* **요지:** 공격자가 **LLM/에이전트**를 이용해 SOAP/XML 등의 **페이로드 변형을 대량 자동화**하고, **피드백 루프**로 우회 조합을 탐색하는 것은 **충분히 현실적**이다.
* **현실적 전제:** 그럼에도 **미패치+구조적 한계(본문 미검사·정규화 부재·Detect-only·TLS 가시성 결핍)** 만으로도 침투는 성립 가능하다.
* **방어 핵심:** (1) **패치 거버넌스**, (2) **TLS 브리징 + 본문 검사 + 정규화 강제**, (3) **응답 본문/사이즈(DLP형) 관측**, (4) **AI·퍼징형 우회에 강한 양의 보안(화이트리스트) 모델**로 재설계.

---

## [시각화] LLM 기반 우회 자동화 플로우

```mermaid
sequenceDiagram
    %% 시퀀스 다이어그램: LLM 보조 WAF 우회(방어 관점)
    participant A as 공격자
    participant G as LLM(페이로드 생성기)
    participant O as 에이전트/오케스트레이터
    participant L as 클라이언트↔LB/프록시
    participant W as WAF
    participant S as 애플리케이션/WAS
    participant T as 텔레메트리/로그 수집
    participant E as 평가자(Evaluator/Auto-Tuner)
    participant D as 수비측 컨트롤(브리징·정규화·화이트리스트·응답DLP)

    Note over A,G: 목표/제약 정의(차단 회피, Low-and-Slow, SLA 유지)
    A->>G: 프롬프트 설계(스키마 합치 유지 + 변형 지시)
    G-->>A: 페이로드 변형 후보들(네임스페이스/인코딩/프레이밍/헤더 조합)
    A->>O: 후보 세트(전송 스케줄·레이트·우선순위)

    loop 자동 퍼징/우회 탐색
        O->>L: 변형 페이로드 전송
        L->>W: 트래픽 전달
        alt 정규화/본문검사 OFF · Detect-only · Passthrough
            W-->>S: 우회되어 애플리케이션 도달
            S-->>T: 실행 결과(응답 코드/바이트/지연/로그)
            Note right of S: (예) RCE/웹셸 시도 또는 오류/예외
        else 정규화/본문검사 ON · Block
            W-->>T: 차단 로그(룰 ID/사유/매칭 포인트)
        end

        %% 수비 측 훅: 가시성/대응 신호가 모두 T로 취합됨
        D-->>W: TLS 브리징/정규화/화이트리스트/정책(차단) 적용
        D-->>T: 응답 본문·사이즈(DLP)·상관분석 결과
        T-->>E: 피드백 신호(HTTP코드, 룰ID, 지연, 응답바이트, 이상치)

        E->>G: 프롬프트/제약 업데이트(더 적게 걸리는 조합 탐색)
        E->>O: 전송 파라미터 조정(레이트·경계값·우선순위)
    end

    Note over D,W: 방어 측 성공 조건
    Note over D,W: TLS 브리징 + 본문검사 + 정규화 강제
    Note over D,W: 스키마 계약(화이트리스트)·정책 Block·예외 TTL
    Note over D,W: 응답 DLP/사이즈·상관분석으로 Low-and-Slow 경보 승격
````

> **요점:** 생성(LLM)→우회 시도→WAF 판정→피드백 최적화의 루프가 **정규화·가시성·운영통제**가 약한 지점을 반복 공략합니다.
> 방어자는 **E블록의 4축**(TLS 브리징·정규화·화이트리스트·응답 DLP)으로 루프를 **끊는 위치**를 명확히 가질 필요가 있습니다.

---

## 1) 위협 모델: “LLM + 자동화 툴체인”의 결합

**공격자 목표:** “**탐지는 지나고 차단은 건드리는**” 페이로드를 빠르게 찾는 것.
**구성요소(개념):**

* **생성기(Generator)**: LLM이 SOAP/XML/JSON 등 **스키마 합치**를 유지하며 **구문·헤더·인코딩**을 다양하게 *합법적으로* 변형.
* **오케스트레이터(Agent)**: API 호출로 수백~수천 변형을 **자동 전송** → **응답/로그**를 수집 → “무엇이 덜 차단되는가?”를 **최적화**.
* **평가자(Evaluator)**: 응답 코드, 지연, 차단 메시지, 바이트 한도 도달 여부, WAF 시그니처 매칭 ID 등의 **피드백 신호**로 **다음 시도**를 조정.

> 방어 관점 포인트: **“LLM이 만드는 것은 ‘신규 취약점’이 아니라 ‘우회를 잘하는 페이로드의 규모화’”**라는 점. 즉, **WAF의 정규화/파싱/가시성의 빈틈**이 핵심 표적이 된다.

---

## 2) AI가 강화하는 4가지 우회 축 (Defender 시각 정리)

### A. **구문·시맨틱 변형(Semantic-preserving)**

* **네임스페이스/Prefix/순서/빈칸/주석/CDATA/엔티티** 등 **표현만 변형**하여 의미는 동일하게 유지.
* **문자 인코딩**(UTF-8/UTF-16/혼합), **이중 인코딩**, **유니코드 분할/동형문자**로 **시그니처 일치 회피**.
* **헤더-본문 불일치**(예: `Content-Type` vs `SOAPAction`)로 **단일 규칙 의존**을 무력화.

### B. **전송·인코딩 계층 교란**

* **gzip/deflate**, **chunked 전송**, **멀티파트 경계값**, **HTTP/2 프레이밍** 등으로 **본문 검사 경계**를 흔듦.
* **Request Body 한도**(바이트 제한) 근처에서 **패딩/노이즈** 삽입 → **부분 검사/미검사** 유도.

### C. **정규화 부재 표적화**

* **XML 정규화(네임스페이스, 엔티티 해석, 순서 표준화), SOAP 파싱**이 없으면 **룰 미적용**.
* **스키마 준수 위장**: 정상 WSDL/스키마를 참고해 **정상처럼 보이는** 메서드/네임스페이스 조합 생성.

### D. **운영상 빈틈 악용**

* **오탐 유발/장애 유도**로 **Detect-only 전환** 또는 **예외 정책** 확대를 끌어내고, 그 창에서 우회 시도.
* **우회 경로**(관리망·직결·백업 포트) 탐색 자동화.

---

## 3) “정규식 WAF는 왜 취약한가?” — 구조적 이유

* **정규화 이전의 매칭 실패:** XML/SOAP는 **정규화 없이** 패턴 매칭하면 **동치 변형**을 무한히 놓칠 수 있음.
* **단편 룰의 한계:** URL/헤더만 보거나, 본문을 보더라도 **한도/코덱/프레이밍**을 정확히 처리하지 못하면 회피됨.
* **규칙 폭증 문제:** 변형마다 룰을 추가하면 **규칙 지옥**과 **성능 저하**로 운영이 무너짐. → **양의 보안 모델**로 전환 필요.

---

## 4) 방어 설계 원칙 (아키텍처 레벨)

### P1. **TLS 브리징 @ WAF**

* **WAF에서 복호화**(브리징) 후 검사·정규화 → 다시 암호화.
* Passthrough 지양: **본문 가시성 0이면** 어떤 AI 우회 탐지도 불가.

### P2. **파싱·정규화-우선 검사**

* **Content-Type 강제**(`text/xml`, `application/soap+xml`), **SOAPAction 일치성** 검증.
* **XML 정규화 + SOAP 파싱** 후 룰 평가(네임스페이스 표준화, 엔티티/CDATA 처리).
* **Request Body 검사 한도 상향**(운영 검증 후 ≥ 8–16MB), **gzip/deflate/chunked 해제 검사**.

### P3. **양의 보안(화이트리스트) 모델**

* 서비스별 **허용 스키마/메서드/네임스페이스/필드 타입**을 **명시 허용**.
* **미등록 조합/불일치**는 차단. (AI 변형은 *허용 집합 밖으로* 밀려나기 쉬움)

### P4. **정책 운영 수칙**

* **Block 모드**가 기본, **오탐 핸들링 절차**(롤백·예외 승인·만료)를 문서화.
* **정책/바이패스 만료**(TTL)와 **변경 사유 기록** 강제.

---

## 5) 룰·정책 설계 가이드(방어 중심, 비침해)

> 아래는 **공격 제작을 돕지 않는** 범위의 **방어 측 체크 포인트**입니다.

* **엔드포인트 스코핑**: `/wls-wsat/*` 등 **위험 엔드포인트는 내부화/차단**을 1순위로 검토.
* **헤더 일관성 검사**: `Content-Type` ↔ `SOAPAction` ↔ **실제 SOAP 바디**의 **불일치** 차단.
* **네임스페이스 체커**: **허용된 네임스페이스 셋**만 통과. 미등록/이중정의/의도치 않은 Prefix는 거부.
* **엔티티/CDATA 방어**: **외부 엔티티(XXE) 비활성**, CDATA 내부 **금칙 토큰**(예: 위험 모듈/클래스명) 탐지.
* **코덱/프레이밍 처리**: gzip/deflate/chunked **해제 후** 검사. 길이 불일치/프레이밍 이상은 차단.
* **길이/복잡도 제한**: **노이즈 패딩/경계값 노리기** 방지(필드별 최대 길이, 노드 깊이 제한).
* **속도·빈도 제어**: 세션/사용자/IP 단위 **레이팅**과 **Low-and-Slow** 탐지(분당 호출수·바이트·변형 다양도).

> **팁:** 룰을 늘리는 대신 **“정상 스키마 프로필”**을 만들고 이를 **계약(Contract)** 으로 강제하는 편이 **규칙 폭증**을 막고 **AI 변형**을 **Out-of-Contract**로 밀어내기 쉽습니다.

---

## 6) 탐지·가시성: “응답 본문/사이즈”의 결합

AI 우회는 **요청만** 보면 놓치기 쉽다. **응답(Response) 기반 DLP형 관측**을 결합해야 한다.

* **응답 본문 키워드/엔트로피/패턴**: 주민번호/CI/카드 식별자 등 데이터 스컴블링 여부 포함.
* **응답 사이즈·레이트**: 세션/URI/계정별 **응답 누적 바이트**, **분당 전송량**, **장기 이동평균 대비 편차**.
* **상관분석**: WAF·프록시·방화벽·DNS·EDR **신호 결합**으로 **Low-and-Slow**를 조기 적발.

---

## 7) “AI 대 AI” — 방어 측 자동화 아이디어

* **변형 퍼징(화이트헤트)**: 내부 스테이징 환경에서 **스키마 합치 변형**을 대량 생성해 **자체 WAF 튜닝**.
* **피드백 기반 룰 강화**: 차단 사유·프린지 케이스를 **LLM 보조 요약**으로 모아 **화이트리스트 모델 업데이트**.
* **정상 프로필 생성기**: 운영 트래픽에서 **정상 SOAP 메서드/네임스페이스/필드 분포**를 학습 → **허용 계약 자동 갱신**(승인 워크플로 포함).
* **응답 DLP 보강**: PII 패턴/엔트로피 탐지를 **모델 보조 룰**로 생성해 **운영 오탐 힌트** 제공.

---

## 8) 퍼플팀 검증 시나리오(안전 가이드)

> 실제 공격 유도 금지. **사내 스테이징/폐쇄 환경에서만**, **합법적 테스트 데이터**로 수행.

1. **베이스라인 측정**: 현행 WAF 설정에서 **정상 트래픽 계약** 정의 및 통과율/지연 측정.
2. **구문 변형 테스트**: 네임스페이스/Prefix/순서/헤더 일치성 **변형 케이스군**으로 **오탐/미탐** 파악(악성 없이).
3. **코덱·프레이밍 테스트**: gzip/chunked/멀티파트/HTTP/2 등 **프레이밍 변형**의 처리 정상성 확인.
4. **한도·레이트 테스트**: Request Body 한도, 응답 사이즈·레이트 기반 **경계값 행동**이 모니터링에 잡히는지 점검.
5. **정책 전환 시뮬레이션**: Detect-only 전환/예외 룰 추가 시 **TTL·승인·감사**가 작동하는지.

**성공 기준:**

* 스키마 계약 위반/헤더-본문 불일치/정규화 실패/한도 초과/프레이밍 이상은 **일관 차단**.
* 응답 기반 지표에서 **Low-and-Slow 패턴**이 **경보**로 승격.
* 정책 변경은 **권한·승인·만료**로 통제.

---

## 9) 운영 거버넌스 & KPI

* **패치 KPI:** CPU/보안 패치 **적용 지연 중앙값**(일), **EoL 잔존 수**.
* **가시성 KPI:** TLS 브리징 **적용률**, **본문 검사 활성률**, **정규화 강제율**.
* **정책 KPI:** **Block 모드 비율**, Detect-only **허용 기간 중앙값**, **예외 룰 만료 준수율**.
* **DLP KPI:** 응답 본문 규칙 **탐지→분류→티켓→조치** 리드타임, **소량 다회 전송** 탐지 히트율.

---

## 10) 사고 대응 체크리스트(요약)

* [ ] **WAF 모드·전환 이력** 확보(차단 카운터=0 구간 확인).
* [ ] **TLS 종단 위치**·**정규화/본문 검사 설정** 증빙.
* [ ] **비경유 루트**(LB/관리망/백업 포트) 존재 여부.
* [ ] **응답 본문/사이즈 지표**와 **프록시/방화벽/DNS 상관**.
* [ ] **정상 스키마 계약** 대비 **위반 조합** 수집(우회 흔적).
* [ ] **예외/화이트리스트** 추가 내역과 **만료/사유**.

---

## 11) 결론 (AI 관점 판정)

> **AI가 우회용 페이로드의 “규모화·최적화”에 기여했을 가능성은 현실적**이다. 그러나 **미패치 + 구조적 한계**만으로도 동일한 결과는 발생한다. **재발 방지의 우선순위**는 (1) 패치 거버넌스, (2) **TLS 브리징 + 본문 검사 + 정규화 강제**, (3) **양의 보안 모델** 전환, (4) **응답 본문/사이즈(DLP형) 관측**의 **구조적 개선**이다. AI는 **방어 자동화**에도 활용하여 **우회 변형을 선제 흡수**해야 한다.

---

### 부록 A. 방어 설정 점검 표(발췌)

* TLS: □ 브리징 □ 키/서명 갱신 □ HTTP/2 처리 점검
* 본문: □ Body 검사 한도(≥8–16MB) □ gzip/deflate/chunked 해제 검사
* 정규화: □ XML canonicalization □ SOAPAction-바디 일치 □ 네임스페이스 화이트리스트
* 정책: □ Block 기본 □ Detect-only TTL □ 예외 만료·감사 기록
* DLP: □ 응답 본문 키워드/엔트로피 □ 응답 사이즈·레이트 이상치
* 상관: □ WAF×Proxy×FW×DNS×EDR 상관 룰

