---
date: 2026-01-24T09:00:00
draft: false
description: "ìœˆë„ìš° í¬ë Œì‹ í•µì‹¬ ì•„í‹°íŒ©íŠ¸ì¸ ShimCacheì™€ Prefetchë¥¼ ë¹„êµí•˜ê³ , Prefetch ë‹¨ë… ì¡°íšŒë¥¼ ë„˜ì–´ AmcacheÂ·ì´ë²¤íŠ¸ ë¡œê·¸(LOLBAS í¬í•¨)ê¹Œì§€ êµì°¨í•´ â€˜ì‹¤í–‰ ì²´ì¸(Execution Chain)â€™ì„ ë³µì›í•˜ëŠ” ì‹¤ë¬´ ì ‘ê·¼ì„ ì •ë¦¬í•©ë‹ˆë‹¤."
featured_image: "cdn/tech/shimcache_prefetch_comparison.png"
tags: ["Digital Forensics", "ShimCache", "Prefetch", "Amcache", "Sysmon", "Windows Event Log", "LOLBAS", "ì¹¨í•´ ì‚¬ê³  ë¶„ì„", "Windows", "Execution Chain", "ì§€ì†ì„±(Persistence)"]
title: "ShimCacheì™€ Prefetch: ì‹¤í–‰ í”ì  ì…ì¦ì—ì„œ ì‹¤í–‰ ì²´ì¸ ë³µì›ê¹Œì§€ (LOLBAS ë¡œê·¸ ì—°ê³„ í¬í•¨)"
---

ğŸ“– **ShimCacheì™€ Prefetch, ì™œ â€˜ë‘˜ ë‹¤â€™ ë´ì•¼ í• ê¹Œ? ê·¸ë¦¬ê³  ì–´ë–»ê²Œ â€˜ì—°ê³„ ì‹¤í–‰ ì²´ì¸â€™ê¹Œì§€ ë³µì›í• ê¹Œ**

> ëª©í‘œ: ì¹¨í•´ ì‚¬ê³  ë¶„ì„(Incident Response)ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ì§ˆë¬¸ì€ ê²°êµ­ ì´ê²ƒì…ë‹ˆë‹¤.  
> **â€œì•…ì„± íŒŒì¼ì´ ì‹¤ì œë¡œ ì‹¤í–‰ë˜ì—ˆëŠ”ê°€?â€**  
> í•˜ì§€ë§Œ ì‹¤ë¬´ì—ì„œ ë” ì¤‘ìš”í•œ ì§ˆë¬¸ì€ í•œ ë‹¨ê³„ ë” ë‚˜ì•„ê°‘ë‹ˆë‹¤.  
> âœ… **â€œì´ ì•…ì„± íŒŒì¼ì„ ì‹¤í–‰Â·ì§€ì›Â·ì€íÂ·ì „ë‹¬í•œ í”„ë¡œê·¸ë¨ ì²´ì¸ì€ ë¬´ì—‡ì¸ê°€?â€**  
>
> ì´ ê¸€ì€ ê¸°ì¡´ **ShimCache vs Prefetch ë¹„êµ**ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, Prefetch/ShimCacheë¥¼ ì‹œì‘ì ìœ¼ë¡œ **ì‹¤í–‰ ì²´ì¸(Execution Chain)ì„ ë³µì›**í•˜ëŠ” í™•ì¥ ë¶„ì„ íë¦„ê¹Œì§€ ì •ë¦¬í•©ë‹ˆë‹¤.

---

## 1. ShimCache (AppCompatCache): â€œì¡´ì¬â€ì˜ ì¦ëª…

ShimCache(Application Compatibility Cache)ëŠ” í”„ë¡œê·¸ë¨ì˜ **í˜¸í™˜ì„± ìœ ì§€**ë¥¼ ìœ„í•´ ì„¤ê³„ëœ ê¸°ëŠ¥ì…ë‹ˆë‹¤.  
í¬ë Œì‹ ê´€ì ì—ì„œëŠ” íŒŒì¼ì´ ì‹œìŠ¤í…œì— â€˜**ì¡´ì¬í–ˆìŒ**â€™ì„ ì¦ëª…í•˜ëŠ” ê°•ë ¥í•œ ì¦ê±°ê°€ ë©ë‹ˆë‹¤.

### âŒ ë¶„ì„ ì‹œ ì£¼ì˜í•  ì  (ì˜¤í•´ì™€ ì§„ì‹¤)

- **ì‹¤í–‰ ì‹œê°„ì´ ì•„ë‹ˆë‹¤**: ShimCacheì˜ íƒ€ì„ìŠ¤íƒ¬í”„ëŠ” ë³´í†µ **ì‹¤í–‰ ì‹œê°ì´ ì•„ë‹ˆë¼ íŒŒì¼ì˜ ë§ˆì§€ë§‰ ìˆ˜ì • ì‹œê°„(Last Modified Time)** ì„±ê²©ìœ¼ë¡œ í•´ì„í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ì‹¤í–‰ ì‹œê°„ìœ¼ë¡œ ë‹¨ì •í•˜ë©´ íƒ€ì„ë¼ì¸ì´ í¬ê²Œ í‹€ì–´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ì‹¤í–‰ ì—¬ë¶€ì˜ ëª¨í˜¸ì„±**: Windows ë²„ì „/ì¡°ê±´ì— ë”°ë¼ â€œìºì‹±ë¨ = ì‹¤í–‰ë¨â€ì´ í•­ìƒ ì„±ë¦½í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- **íœ˜ë°œì„± íŠ¹ì„±**: ì¼ë°˜ì ìœ¼ë¡œ **ì •ìƒ ì¢…ë£Œ/ì¬ë¶€íŒ… ì‹œì ì— ê¸°ë¡**ë˜ëŠ” ì„±ê²©ì´ ìˆì–´, ê°•ì œ ì¢…ë£Œ/í¬ë˜ì‹œ ìƒí™©ì—ì„œëŠ” ìµœì‹  í”ì ì´ ëˆ„ë½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### âœ… ShimCacheì˜ í•µì‹¬ ê°€ì¹˜

- **íŒŒì¼ ì¡´ì¬ ì…ì¦**: ì›ë³¸ì´ self-delete ë˜ì—ˆì–´ë„ ê²½ë¡œ í”ì ì´ ë‚¨ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ì´ë™ ê²½ë¡œ ì¶”ì **: ì•…ì„± íŒŒì¼ì´ ì–´ëŠ ê²½ë¡œì— ìˆì—ˆëŠ”ì§€ ì „ì²´ ê²½ë¡œ ê¸°ë°˜ ì¶”ì ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## 2. Prefetch: â€œì‹¤í–‰â€ì˜ í™•ì¦

PrefetchëŠ” ìœˆë„ìš°ì˜ **ë¶€íŒ… ë° ì‹¤í–‰ ì†ë„ í–¥ìƒ**ì„ ìœ„í•œ ë©”ì»¤ë‹ˆì¦˜ì´ë©°, ë¶„ì„ê°€ì—ê²ŒëŠ” â€œ**ì‹¤í–‰ë˜ì—ˆë‹¤**â€ë¥¼ ê°€ì¥ ê°•í•˜ê²Œ ë’·ë°›ì¹¨í•©ë‹ˆë‹¤.

### ğŸ“Œ Prefetchê°€ ì œê³µí•˜ëŠ” ê²°ì •ì  ì¦ê±°

- **í™•ì‹¤í•œ ì‹¤í–‰ ë‹¨ì„œ**: Prefetch íŒŒì¼(`.pf`)ì´ ìƒì„±ë˜ì—ˆë‹¤ë©´ í•´ë‹¹ ì‹¤í–‰ íŒŒì¼ì€ **ì‹¤ì œë¡œ ì‹¤í–‰**ë˜ì—ˆì„ ê°€ëŠ¥ì„±ì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.
- **ì •í™•í•œ ì‹¤í–‰ ì‹œê°**: ë§ˆì§€ë§‰ ì‹¤í–‰ ì‹œê°ë¿ ì•„ë‹ˆë¼(Windows 8+ì—ì„œ í”íˆ ê´€ì°°) **ìµœê·¼ ì—¬ëŸ¬ íšŒ(ëŒ€ê°œ 8íšŒ)ì˜ ì‹¤í–‰ ì‹œê°**ì„ ê¸°ë¡í•˜ëŠ” êµ¬ì¡°ê°€ ì¼ë°˜ì ì…ë‹ˆë‹¤.
- **ì‹¤í–‰ íšŸìˆ˜(Run Count)**: ì‹¤í–‰ ë¹ˆë„ ì¶”ì •ì— ìœ ë¦¬í•©ë‹ˆë‹¤.

### âŒ í•œê³„ì 

- **ê°œìˆ˜ ì œí•œ/ë®ì–´ì“°ê¸°**: ì‹œìŠ¤í…œì— ë”°ë¼ Prefetch ì €ì¥ ê°œìˆ˜ ì œí•œìœ¼ë¡œ ì˜¤ë˜ëœ ê¸°ë¡ì´ ë®ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **í™˜ê²½ì— ë”°ë¼ ë¹„í™œì„±/ë¶€ì¬ ê°€ëŠ¥**: ì¼ë¶€ ì„œë²„/ì •ì±…/ì €ì¥ì¥ì¹˜ í™˜ê²½ì—ì„œëŠ” Prefetchê°€ ê¸°ëŒ€ëŒ€ë¡œ ë‚¨ì§€ ì•Šì„ ìˆ˜ ìˆì–´ â€œì—†ë‹¤ = ì‹¤í–‰ ì•ˆ í–ˆë‹¤â€ë¡œ ë‹¨ì •í•˜ë©´ ìœ„í—˜í•©ë‹ˆë‹¤.
- **ë‹¨ë…ìœ¼ë¡œëŠ” â€˜ì—°ê³„â€™ê°€ ì•½í•¨**: PrefetchëŠ” â€œì‹¤í–‰â€ì„ ì˜ ë§í•´ì£¼ì§€ë§Œ, **ëˆ„ê°€ ì‹¤í–‰í–ˆëŠ”ì§€(ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤), ì–´ë–¤ ì²´ì¸ì¸ì§€**ëŠ” Prefetchë§Œìœ¼ë¡œ ì™„ì „ ë³µì›ì´ ì–´ë µìŠµë‹ˆë‹¤.

---

## 3. í•œëˆˆì— ë³´ëŠ” ë¹„êµ: ShimCache vs Prefetch

ë‘ ì•„í‹°íŒ©íŠ¸ëŠ” ìƒí˜¸ ë³´ì™„ì ì…ë‹ˆë‹¤. í•˜ë‚˜ë§Œìœ¼ë¡œëŠ” ì „ì²´ ê·¸ë¦¼ì„ ê·¸ë¦¬ê¸° ì–´ë µìŠµë‹ˆë‹¤.

| ë¹„êµ í•­ëª© | ğŸ”¹ ShimCache (AppCompatCache) | ğŸ”¹ Prefetch |
| --- | --- | --- |
| ì›ë˜ ëª©ì  | ì• í”Œë¦¬ì¼€ì´ì…˜ í˜¸í™˜ì„± ìœ ì§€ | í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì†ë„ í–¥ìƒ |
| ì €ì¥ ìœ„ì¹˜ | ë ˆì§€ìŠ¤íŠ¸ë¦¬ (`SYSTEM` Hive) | íŒŒì¼ ì‹œìŠ¤í…œ (`C:\Windows\Prefetch`) |
| ê¸°ë¡ ì‹œì  | ì‹œìŠ¤í…œ ì¢…ë£Œ/ì¬ë¶€íŒ… ì‹œ ë°˜ì˜ë˜ëŠ” ì„±ê²© | í”„ë¡œê·¸ë¨ ì‹¤í–‰ ì‹œ ìƒì„±ë˜ëŠ” ì„±ê²© |
| ì‹œê°„ ì •ë³´ | ì‹¤í–‰ ì‹œê°ì´ ì•„ë‹Œ ê°’ìœ¼ë¡œ ì˜¤í•´ ìœ„í—˜ | ì‹¤í–‰ ì‹œê°„(Last Run Time) ì¤‘ì‹¬ |
| í¬ë Œì‹ ì˜ë¯¸ | íŒŒì¼ì´ ì‹œìŠ¤í…œì— **ì¡´ì¬í–ˆìŒ**ì„ ì…ì¦ | íŒŒì¼ì´ **ì‹¤í–‰ë˜ì—ˆìŒ**ì„ ë’·ë°›ì¹¨ |
| ì‚­ì œ ì‹œ | ì›ë³¸ íŒŒì¼ ì‚­ì œë¼ë„ í”ì ì´ ë‚¨ì„ ìˆ˜ ìˆìŒ | ì›ë³¸ íŒŒì¼ ì‚­ì œë¼ë„ `.pf`ê°€ ë‚¨ì„ ìˆ˜ ìˆìŒ |

---

## 4. í˜„ì‹¤ì ì¸ ë¶„ì„ ì‹œë‚˜ë¦¬ì˜¤: â€œì‹¤í–‰ í›„ ì‚­ì œâ€ ëŒ€ì‘

### ğŸ“Œ ì‹œë‚˜ë¦¬ì˜¤: ê³µê²©ìê°€ `malware.exe` ì‹¤í–‰ í›„ ì‚­ì œí•˜ê³  ë„ë§ê°

#### 1) ShimCacheì—ì„œ í”ì  í¬ì°©

- **ë°œê²¬**: `C:\Temp\malware.exe`
- **ì˜ë¯¸**: â€œì´ ì‹œìŠ¤í…œì— í•´ë‹¹ íŒŒì¼ì´ ì¡´ì¬í–ˆì—ˆë‹¤.â€

#### 2) Prefetchë¡œ í–‰ìœ„ í™•ì¦/ê°•í™”

- **ë°œê²¬**: `MALWARE.EXE-12A3B456.pf`
- **ì˜ë¯¸**: â€œì •í™•íˆ ì–¸ì œ, ëª‡ ë²ˆ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€â€ì— ëŒ€í•œ ê°•í•œ ë‹¨ì„œ í™•ë³´  
- **ì¶”ê°€ ë‹¨ì„œ**: ë¡œë“œ DLL/ì°¸ì¡° íŒŒì¼ ëª©ë¡ì—ì„œ ë„¤íŠ¸ì›Œí¬/ì•”í˜¸í™”/ìŠ¤í¬ë¦½íŠ¸ í”ì  ë“± ì •í™© í™•ë³´ ê°€ëŠ¥

---

## 5. ì¶”ì²œ ê¸°ë³¸ íë¦„ë„ (ì¡´ì¬ â†’ ì‹¤í–‰ ì…ì¦)

```mermaid
flowchart TD
  Start[ì‚¬ê³  ë°œìƒ ë° ë¶„ì„ ì‹œì‘] --> CheckFile[íŒŒì¼ ì¡´ì¬ ì—¬ë¶€ í™•ì¸]

  CheckFile -->|íŒŒì¼ ì‚­ì œë¨| CheckShim[ShimCache ë¶„ì„]
  CheckShim -->|ê¸°ë¡ ì—†ìŒ| DeepScan[MFT/ì €ë„ë§ ë¶„ì„]
  CheckShim -->|ê¸°ë¡ ìˆìŒ| CheckPrefetch[Prefetch í´ë” í™•ì¸]

  CheckPrefetch -->|pf íŒŒì¼ ì¡´ì¬| ConfirmExec["ì‹¤í–‰ í™•ì • & ì‹œê°„/íšŸìˆ˜ ë¶„ì„"]
  CheckPrefetch -->|pf íŒŒì¼ ì—†ìŒ| InferredExec["ì‹¤í–‰ ì—¬ë¶€ ë¶ˆíˆ¬ëª… (ë‹¨ìˆœ ì¡´ì¬ ê°€ëŠ¥ì„±)"]

  ConfirmExec --> Report[ë³´ê³ ì„œ ì‘ì„±: ì‹¤í–‰ ì…ì¦]
  InferredExec --> Report
```

---

# ì—¬ê¸°ì„œë¶€í„°ê°€ â€œì‹¤ë¬´ í™•ì¥â€: Prefetch ë‹¨ë…ì„ ë„˜ì–´ ì‹¤í–‰ ì²´ì¸ ë³µì›í•˜ê¸°

## 6. ê´€ì  ì „í™˜: PrefetchëŠ” â€˜ê²°ë¡ â€™ì´ ì•„ë‹ˆë¼ â€˜ì‹œì‘ì â€™

PrefetchëŠ” **â€œì´ ì‹¤í–‰ íŒŒì¼ì´ ì‹¤í–‰ëœ ì ì´ ìˆë‹¤â€**ë¥¼ ë§í•´ì£¼ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.  
í•˜ì§€ë§Œ ì‹¤ë¬´ì—ì„œ ìš°ë¦¬ê°€ ë³µì›í•´ì•¼ í•˜ëŠ” ê²ƒì€ ë³´í†µ ì´ê²ƒì…ë‹ˆë‹¤.

> âŒ â€œì´ ì•…ì„± íŒŒì¼ì´ ì‹¤í–‰ëë‚˜?â€  
> âœ… **â€œì´ ì•…ì„± íŒŒì¼ì„ ì‹¤í–‰Â·ì§€ì›Â·ì€íÂ·ì „ë‹¬í•œ í”„ë¡œê·¸ë¨ì€ ë¬´ì—‡ì¸ê°€?â€**

ì¦‰, ì¤‘ì‹¬ì„ **â€˜ì—°ê³„ í”ì â€™**(Correlation)ìœ¼ë¡œ ì˜®ê¸°ë©´ ë¶„ì„ì´ í™•ì¥ë©ë‹ˆë‹¤.

---

## 7. Prefetch ë‚´ë¶€ì—ì„œ ë°”ë¡œ ë½‘ì„ ìˆ˜ ìˆëŠ” â€œì—°ê³„ ë‹¨ì„œâ€

### 7.1 DLL ë¡œë“œ/ì°¸ì¡° í”ì : ì¸ì ì…˜Â·ì‚¬ì´ë“œë¡œë”© ì •í™©

Prefetchì—ëŠ” ì‹¤í–‰ ì‹œì ì— **ì°¸ì¡°ëœ íŒŒì¼ ê²½ë¡œ(íŠ¹íˆ DLL í¬í•¨)**ê°€ ë‚¨ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.  
ì•„ë˜ íŒ¨í„´ì€ ì‹¤ë¬´ì—ì„œ ìì£¼ â€œì—°ê³„ ë‹¨ì„œâ€ê°€ ë©ë‹ˆë‹¤.

- ì •ìƒ ì•±ì—ì„  ë³´ê¸° í˜ë“  DLL
- `Temp`, `AppData`, `ProgramData` í•˜ìœ„ DLL
- íŒŒì¼ëª… ìœ„ì¥ DLL (`version.dll`, `wininet.dll` ë“±)

â¡ï¸ **ì˜ë¯¸**

- ì¸ì ì…˜/ì‚¬ì´ë“œë¡œë”© ì—¬ë¶€ íŒë‹¨
- ë“œë¡œí¼Â·ë¡œë” êµ¬ë¶„ì— ë„ì›€

---

## 8. ShimCacheì™€ Prefetchë¥¼ â€œì‹œê°„ ì¶•â€ìœ¼ë¡œ ê²°í•©í•˜ê¸°

ë‘˜ì„ êµì°¨í•˜ë©´ ë‹¨ìˆœíˆ â€œìˆë‹¤/ì—†ë‹¤â€ë¥¼ ë„˜ì–´ **ìƒí™©ì„ ë¶„ê¸°**í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

| ìƒí™© | í•´ì„(í˜„ì¥ ê´€ì ) |
| --- | --- |
| ShimCacheë§Œ ìˆìŒ | ë“œë¡­/ìœ ì…ë§Œ ëì„ ê°€ëŠ¥ì„±, ë˜ëŠ” ì‹¤í–‰ ì¦ê±°ê°€ ë‹¤ë¥¸ ê³³ì— ì¡´ì¬ |
| Prefetch + ShimCache | ì‹¤í–‰ + ë°˜ë³µ ê°€ëŠ¥ì„±(íƒ€ì„ë¼ì¸ ê°•í™”) |
| Prefetch ì—†ìŒ + ShimCache ìˆìŒ | 1íšŒì„±/íŠ¹ìˆ˜ í™˜ê²½/Prefetch ë¹„í™œì„±/ë®ì–´ì“°ê¸° ë“± ê°€ëŠ¥ì„±(ì¶”ê°€ ì¦ê±° í•„ìš”) |

â¡ï¸ **ì—°ê³„ í¬ì¸íŠ¸(ì‹¤ë¬´ ì²´í¬)**

- ë™ì¼ ë””ë ‰í„°ë¦¬ì— ì¡´ì¬í–ˆë˜ **ë‹¤ë¥¸ ì‹¤í–‰ íŒŒì¼/ìŠ¤í¬ë¦½íŠ¸**(ë“œë¡œí¼/ë‹¤ìš´ë¡œë”/ë¡œë”)
- ì‹œê°„ íë¦„ìƒ â€œë¨¼ì € ë“±ì¥í•œ íŒŒì¼â€ê³¼ â€œë’¤ì´ì–´ ì‹¤í–‰ëœ íŒŒì¼â€ì˜ ê´€ê³„

---

## 9. Amcache.hve: â€œì„¤ì¹˜í˜• ì•…ì„±ì½”ë“œ/ìœ ì… ê²½ë¡œâ€ ì¶”ì ì˜ í•µì‹¬

ShimCache/Prefetchê°€ â€œì¡´ì¬/ì‹¤í–‰â€ì„ ë‹¤ë£¬ë‹¤ë©´, AmcacheëŠ” ê²½ìš°ì— ë”°ë¼ **ìœ ì…(ì„¤ì¹˜) ê´€ì **ì—ì„œ í›¨ì”¬ ê°•ë ¥í•´ì§‘ë‹ˆë‹¤.

í™•ì¸ í¬ì¸íŠ¸(ëŒ€í‘œ):

- File ID / SHA1(ë˜ëŠ” ì‹ë³„ í•´ì‹œ)
- Program Name
- First Install Time(í™˜ê²½/ë²„ì „ì— ë”°ë¼ ìƒì´)
- Parent Path / Source ê²½ë¡œ ë‹¨ì„œ

â¡ï¸ **ì˜ë¯¸**

- ë“œë¡œí¼ â†’ í˜ì´ë¡œë“œ êµ¬ì¡° íŒŒì•…(â€œëˆ„ê°€ ë¬´ì—‡ì„ ë–¨ì–´ëœ¨ë ¸ë‚˜â€)
- ì •ìƒ í”„ë¡œê·¸ë¨ ìœ„ì¥ ì—¬ë¶€ íŒë‹¨
- ì‹¤í–‰ì´ ë¶ˆí™•ì‹¤í•´ë„ **ì‹œìŠ¤í…œ ìœ ì… ì‚¬ì‹¤**ì„ ì…ì¦

---

## 10. (ë¡œê·¸ê°€ ìˆë‹¤ë©´ ìµœê°•) Sysmon/ë³´ì•ˆ ë¡œê·¸ë¡œ â€œí”„ë¡œì„¸ìŠ¤ íŠ¸ë¦¬â€ ë³µì›

Prefetchë¡œëŠ” ì ˆëŒ€ ì™„ì „í•˜ê²Œ ë³´ê¸° ì–´ë ¤ìš´ ê²ƒì´ **ë¶€ëª¨-ìì‹ í”„ë¡œì„¸ìŠ¤ ê´€ê³„**ì…ë‹ˆë‹¤.  
Sysmon(ë˜ëŠ” EDR/XDR/ë³´ì•ˆë¡œê·¸)ì´ ìˆë‹¤ë©´, ì‹¤í–‰ ì²´ì¸ ë³µì›ì´ ê¸‰ê²©íˆ ì‰¬ì›Œì§‘ë‹ˆë‹¤.

### âœ” Sysmon Event ID 1 (Process Create)ì—ì„œ ë³´ëŠ” í•µì‹¬ í•„ë“œ

- `ParentImage`
- `CommandLine`
- `CurrentDirectory`
- `Hashes`
- `ProcessGUID`

ì˜ˆì‹œ(ì „í˜•ì ì¸ ì²´ì¸ í˜•íƒœ):

```text
powershell.exe
 â””â”€â”€ rundll32.exe
      â””â”€â”€ evil.dll
```

â¡ï¸ **í•µì‹¬**  
PrefetchëŠ” â€œrundll32ê°€ ì‹¤í–‰ëë‹¤â€ë¥¼ ë§í•´ì¤„ ìˆ˜ ìˆì–´ë„,  
**â€œëˆ„ê°€ rundll32ë¥¼ ë¶ˆë €ëŠ”ì§€, ì–´ë–¤ ì»¤ë§¨ë“œë¼ì¸ì´ì—ˆëŠ”ì§€â€**ëŠ” ë¡œê·¸ê°€ í›¨ì”¬ ê°•í•©ë‹ˆë‹¤.

---

### 10.1 LOLBAS íƒì§€ í›„, ShimCache / Amcache / Prefetchì™€ â€œë°”ë¡œâ€ ë¶™ì´ê¸° ì¢‹ì€ ë¡œê·¸ 5ê°œ (ì±„ë„ ê¸°ì¤€)

LOLBAS(â€œLiving off the Land Binaries and Scriptsâ€)ëŠ” **ìš´ì˜ì²´ì œì— ì›ë˜ í¬í•¨ëœ ì •ìƒ ë°”ì´ë„ˆë¦¬/ìŠ¤í¬ë¦½íŠ¸**ë¥¼ ì•…ìš©í•´ ê³µê²©ì„ ì§„í–‰í•˜ëŠ” íŒ¨í„´ì„ ë§í•©ë‹ˆë‹¤. ([LOLBAS Project][8])  
ì´ ê²½ìš° íƒì§€ì˜ ì‹œì‘ì ì´ ì´ë²¤íŠ¸ ë¡œê·¸ì¸ ê²½ìš°ê°€ ë§ê¸° ë•Œë¬¸ì—, ì•„ë˜ 5ê°œ ì±„ë„ì„ ìš°ì„  ë³´ë©´ **ì•„í‹°íŒ©íŠ¸(ShimCache/Amcache/Prefetch)ì™€ ì¦‰ì‹œ êµì°¨**í•˜ê¸°ê°€ ì¢‹ìŠµë‹ˆë‹¤.

---

#### 1) Sysmon ë¡œê·¸: Process Create

- **ì±„ë„**: `Applications and Services Logs > Microsoft > Windows > Sysmon > Operational`
- **ì£¼ìš” Event ID**: **1 (Process creation)**
- **ì™œ 1ìˆœìœ„ì¸ê°€**
  - ì‹¤í–‰ íŒŒì¼ ê²½ë¡œ, **ì „ì²´ CommandLine**, **ParentImage**, **Hashes**, **ProcessGUID** ë“± â€œì—°ë™ í‚¤â€ê°€ ê°€ì¥ í’ë¶€í•©ë‹ˆë‹¤. ([Microsoft Learn][1])
- **ì•„í‹°íŒ©íŠ¸ ì—°ë™ í¬ì¸íŠ¸**
  - `Image`(ì‹¤í–‰ íŒŒì¼ ì „ì²´ ê²½ë¡œ) â†” Prefetch/ShimCache/Amcacheì˜ ë™ì¼ ê²½ë¡œ/íŒŒì¼ëª… ë§¤ì¹­
  - `Hashes` â†” Amcacheì— ë‚¨ëŠ” ì‹ë³„ì •ë³´(í•´ì‹œ) ê¸°ë°˜ êµì°¨ê²€ì¦
  - `ProcessGUID` â†” ë‹¤ë¥¸ Sysmon ì´ë²¤íŠ¸(ë„¤íŠ¸ì›Œí¬/íŒŒì¼ ìƒì„± ë“±)ì™€ ì²´ì¸ êµ¬ì„±ì— ìœ ë¦¬

---

#### 2) Windows ë³´ì•ˆ ë¡œê·¸: í”„ë¡œì„¸ìŠ¤ ìƒì„±(ê¸°ë³¸ ê°ì‚¬)

- **ì±„ë„**: `Windows Logs > Security`
- **ì£¼ìš” Event ID**: **4688 (A new process has been created)**
- **ì™œ í¬í•¨í•˜ë‚˜**
  - Sysmonì´ ì—†ëŠ” í™˜ê²½ì—ì„œë„ â€œìµœì†Œí•œì˜ ì‹¤í–‰ ì¦ê±°(í”„ë¡œì„¸ìŠ¤ ìƒì„±)â€ë¥¼ ê°€ì¥ í‘œì¤€ì ìœ¼ë¡œ í™•ë³´í•©ë‹ˆë‹¤. ([Microsoft Learn][2])
- **ì£¼ì˜/ê¶Œì¥ ì„¤ì •**
  - 4688ì„ ë³´ë ¤ë©´ **Audit Process Creation**ì´ í•„ìš”í•˜ê³ ,
  - ì»¤ë§¨ë“œë¼ì¸ê¹Œì§€ ë‚¨ê¸°ë ¤ë©´ **â€œí”„ë¡œì„¸ìŠ¤ ìƒì„± ì‹œ ëª…ë ¹ì¤„ í¬í•¨(Include command line in process creation events)â€** ì •ì±… ì„¤ì •ì´ ì¤‘ìš”í•©ë‹ˆë‹¤. ([Microsoft Learn][3])
- **ì•„í‹°íŒ©íŠ¸ ì—°ë™ í¬ì¸íŠ¸**
  - `NewProcessName`(ì‹¤í–‰ ê²½ë¡œ) + `CommandLine`(ì˜µì…˜) â†” Prefetch(ì‹¤í–‰ ì‚¬ì‹¤/ì‹œê°„) + ShimCache(ì¡´ì¬ ê²½ë¡œ) + Amcache(íŒŒì¼ ë©”íƒ€)ë¡œ êµì°¨

---

#### 3) PowerShell ë¡œê·¸: Script Block Logging

- **ì±„ë„**: `Applications and Services Logs > Microsoft > Windows > PowerShell > Operational`
- **ì£¼ìš” Event ID**: **4104 (Script Block Logging)**
- **ì™œ í¬í•¨í•˜ë‚˜**
  - LOLBASì—ì„œ ê°€ì¥ í”í•œ ì¶•ì´ PowerShellì´ê³ , 4104ëŠ” **ì‹¤ì œ ì‹¤í–‰ëœ ìŠ¤í¬ë¦½íŠ¸ ë¸”ë¡ ë‚´ìš©**ì„ ë‚¨ê²¨ â€œë¬´ì—‡ì„ í–ˆëŠ”ì§€â€ê¹Œì§€ ë¶™ìŠµë‹ˆë‹¤. ([Microsoft Learn][4])
- **ì•„í‹°íŒ©íŠ¸ ì—°ë™ í¬ì¸íŠ¸**
  - 4104 ë‚´ìš©ì—ì„œ ë“œë¡­/ë‹¤ìš´ë¡œë“œ/ì‹¤í–‰ ê²½ë¡œê°€ ë‚˜ì˜¤ë©´  
    â†” ê·¸ ê²½ë¡œë¥¼ ShimCache/Amcacheì—ì„œ â€œì¡´ì¬/ìœ ì…â€ í™•ì¸  
    â†” í•´ë‹¹ ì‹¤í–‰ íŒŒì¼ì€ Prefetchë¡œ â€œì‹¤í–‰â€ í™•ì¦

---

#### 4) ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ ë¡œê·¸: Taskë¥¼ í†µí•œ ì‹¤í–‰(LOLBAS í˜¸ì¶œ ê²½ë¡œ)

- **ì±„ë„**: `Applications and Services Logs > Microsoft > Windows > TaskScheduler > Operational`
- **ì£¼ìš” Event ID(ìì£¼ ì“°ëŠ” ì¶•)**: **200 (Action started), 201 (Action completed)** *(í™˜ê²½ì— ë”°ë¼ 100/102 ë“±ë„ í•¨ê»˜)*
- **ì™œ í¬í•¨í•˜ë‚˜**
  - ê³µê²©ìê°€ `schtasks`ë¡œ LOLBASë¥¼ ì‹¤í–‰/ì§€ì†í™”í•˜ëŠ” ê²½ìš°ê°€ í”í•˜ê³ , TaskScheduler Operationalì˜ 200/201ì€ **ì•¡ì…˜(ì‹¤í–‰ í”„ë¡œê·¸ë¨/ì¸ì)** ê´€ì°°ì— ìœ ìš©í•©ë‹ˆë‹¤. ([Splunk Research][5])
- **ì•„í‹°íŒ©íŠ¸ ì—°ë™ í¬ì¸íŠ¸**
  - Task actionì— ë‚˜ì˜¨ ì‹¤í–‰ íŒŒì¼/ì¸ì ê²½ë¡œ â†” Prefetch/ShimCache/Amcacheë¡œ ë™ì¼ íŒŒì¼ êµì°¨
  - â€œëˆ„ê°€(ê³„ì •/ê¶Œí•œ)â€ + â€œë¬´ì—‡ì„(ì•¡ì…˜/ì¸ì)â€ë¡œ ì‹¤í–‰ ì²´ì¸ì„ ë³´ê°•

---

#### 5) WMI Activity ë¡œê·¸: WMI ê¸°ë°˜ ì‹¤í–‰/ì§€ì†ì„± ë‹¨ì„œ

- **ì±„ë„**: `Applications and Services Logs > Microsoft > Windows > WMI-Activity > Operational`
- **ì£¼ìš” Event ID(ëŒ€í‘œ ë¬¶ìŒ)**: **5857, 5858, 5859, 5860, 5861**
  - ì˜ˆ: 5857(ì‘ì—… ì‹œì‘), 5858(í´ë¼ì´ì–¸íŠ¸ ì‹¤íŒ¨) ë“± WMI ë™ì‘ ë‹¨ì„œë¥¼ ë‚¨ê¹ë‹ˆë‹¤. ([NXLog][6])
  - íŠ¹íˆ **5861ì€ â€œì˜êµ¬ WMI ì´ë²¤íŠ¸ êµ¬ë…(permanent subscription)â€** ë‹¨ì„œë¡œ ìì£¼ í™œìš©ë©ë‹ˆë‹¤. ([Red Canary][7])
- **ì•„í‹°íŒ©íŠ¸ ì—°ë™ í¬ì¸íŠ¸**
  - WMI ì´ë²¤íŠ¸ì—ì„œ ë³´ì´ëŠ” ì‹¤í–‰/ì»¤ë§¨ë“œ/ê´€ë ¨ í”„ë¡œì„¸ìŠ¤ ë‹¨ì„œ â†” Prefetch(ì‹¤í–‰) + ShimCache/Amcache(ê²½ë¡œ/ìœ ì…)ë¡œ êµì°¨

---

#### (ë³´ë„ˆìŠ¤) ìœ„ 5ê°œ ë¡œê·¸ë¥¼ ì•„í‹°íŒ©íŠ¸ì™€ â€œë¶™ì¼ ë•Œâ€ ìµœì†Œ ì—°ë™ í‚¤

- **ì‹¤í–‰ íŒŒì¼ Full Path**: `Image / NewProcessName / Task Action path`
- **CommandLine**: LOLBASëŠ” ì¸ìì— ë³¸ì²´(í˜ì´ë¡œë“œ/DLL/ìŠ¤í¬ë¦½íŠ¸/URL)ë¥¼ ìˆ¨ê¸°ëŠ” ê²½ìš°ê°€ ë§ì•„ í•µì‹¬ í”¼ë²—
- **ì‹œê°„(UTC/ë¡œì»¬) + í˜¸ìŠ¤íŠ¸ ì‹ë³„ì**
- (ê°€ëŠ¥í•˜ë©´) **Hash**: Sysmonì´ ê°€ì¥ ê°•í•¨ ([Microsoft Learn][1])

---

## 11. â€œëˆ„ê°€ ë‹¤ì‹œ ì‚´ë ¸ëŠ”ê°€â€: ì§€ì†ì„±(Persistence) íŠ¸ë¦¬ê±° ì¶”ì 

ìµœì´ˆ ì‹¤í–‰ íŒŒì¼ê³¼ **ì¬ì‹¤í–‰(ì§€ì†ì„±) íŠ¸ë¦¬ê±°**ëŠ” ë‹¤ë¥¸ ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.  
ë”°ë¼ì„œ ì‹¤í–‰ ì²´ì¸ì˜ ë§ˆì§€ë§‰ í¼ì¦ì€ ë³´í†µ **ì§€ì†ì„± ë©”ì»¤ë‹ˆì¦˜**ì…ë‹ˆë‹¤.

ëŒ€í‘œ í™•ì¸ ëŒ€ìƒ:

- Scheduled Tasks (`schtasks /query /v`)
- Services (`HKLM\System\CurrentControlSet\Services`)
- WMI Event Subscription (Filter/Consumer/Binding)

â¡ï¸ **ì˜ë¯¸**

- â€œìµœì´ˆ ì‹¤í–‰ í”„ë¡œê·¸ë¨ â‰  ì§€ì†ì„± íŠ¸ë¦¬ê±°â€ë¥¼ ë¶„ë¦¬í•´ì„œ ë´ì•¼ í•©ë‹ˆë‹¤.
- ì •ìƒ í”„ë¡œê·¸ë¨ ì´ë¦„ì„ ì“´ ì•…ì„± ì„œë¹„ìŠ¤/ì‘ì—…ì´ ìˆ¨ì–´ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 12. Prefetchê°€ ì—†ê±°ë‚˜ ì•½í•  ë•Œ: MFT / USN Journalë¡œ â€œë“œë¡­ ë¬¶ìŒâ€ ì°¾ê¸°

Prefetchê°€ ë¹„í™œì„±/ë®ì–´ì“°ê¸°/ì‚­ì œ ë“±ìœ¼ë¡œ ë¹„ì–´ ìˆìœ¼ë©´, íŒŒì¼ì‹œìŠ¤í…œ ë ˆë²¨ì´ íŠ¹íˆ ì¤‘ìš”í•´ì§‘ë‹ˆë‹¤.

í™•ì¸ í¬ì¸íŠ¸:

- ì•…ì„± íŒŒì¼ ìƒì„± ì§í›„ ìƒì„±ëœ `.exe`, `.dll`, `.ps1`
- ë™ì¼ ì´ˆ ë‹¨ìœ„ì— ìƒì„±ëœ íŒŒì¼ ë¬¶ìŒ

â¡ï¸ **ì˜ë¯¸**

- ë“œë¡­ í–‰ìœ„ ì…ì¦
- ì‹¤í–‰ íŒŒì¼ ê°„ ê´€ê³„ì„± ë„ì¶œ

---

## 13. ì‹¤ë¬´ìš© â€œì—°ê³„ ì‹¤í–‰ ë¶„ì„(Execution Correlation)â€ ìš”ì•½ íë¦„

```text
[ì•…ì„± íŒŒì¼ ë°œê²¬]
      â†“
[Prefetch ì¡´ì¬ ì—¬ë¶€]
      â†“
[DLL / ì‹¤í–‰ ì‹œê°„ í™•ë³´]
      â†“
[ShimCache / Amcache êµì°¨]
      â†“
[Sysmon / Event Log]
      â†“
[ì§€ì†ì„± ë©”ì»¤ë‹ˆì¦˜]
      â†“
[ì‹¤í–‰ ì²´ì¸ ì¬êµ¬ì„±]
```

---

## 14. PLURA-Forensic ê´€ì  ì œì•ˆ: â€œExecution Correlation Analysisâ€ë¡œ ê²©ìƒ

Prefetchë¥¼ **ë‹¨ì¼ ê²°ê³¼ í•­ëª©**ìœ¼ë¡œ ë‘ëŠ” ìˆœê°„, ë¶„ì„ì€ â€œì â€ì—ì„œ ë©ˆì¶¥ë‹ˆë‹¤.  
í˜„ì¥ ëŒ€ì‘ì€ **ì„ (ì²´ì¸)**ì„ ë³µì›í•´ì•¼ í•©ë‹ˆë‹¤.

### â–¶ ì¹´í…Œê³ ë¦¬ ì œì•ˆ: â€œì—°ê³„ ì‹¤í–‰ ë¶„ì„(Execution Correlation Analysis)â€

í¬í•¨ ìš”ì†Œ(ê¶Œì¥ ë¬¶ìŒ):

- Prefetch
- ShimCache
- Amcache
- Process Tree(ë¡œê·¸ ê¸°ë°˜)
- Persistence Artifacts

â¡ï¸ ìµœì¢… ëª©í‘œëŠ”  
**â€œì•…ì„± íŒŒì¼ ë‹¨ë… ì…ì¦â€ â†’ â€œê³µê²© ì‹œë‚˜ë¦¬ì˜¤ ë³µì›â€** ì…ë‹ˆë‹¤.

---

## 15. í˜„ì¥ì—ì„œ ë°”ë¡œ ì“°ëŠ” ì²´í¬ë¦¬ìŠ¤íŠ¸ (10ë¬¸ 10ë‹µ)

1) **ì´ íŒŒì¼ì€ ì‹¤í–‰ëë‚˜?** â†’ Prefetchë¡œ í™•ì¸  
2) **ëª‡ ë²ˆ ì‹¤í–‰ëë‚˜?** â†’ Run Count/ìµœê·¼ ì‹¤í–‰ ê¸°ë¡  
3) **ì‹¤í–‰ ì‹œê°ì€ ì–¸ì œì˜€ë‚˜?** â†’ Prefetch ì‹œê°„ ê¸°ë°˜ íƒ€ì„ë¼ì¸  
4) **ì‹¤í–‰ ì‹œ ë¬´ì—‡ì„ ë¡œë“œ/ì°¸ì¡°í–ˆë‚˜?** â†’ Prefetchì˜ DLL/ì°¸ì¡° íŒŒì¼  
5) **ê°™ì€ í´ë”ì— ì—°ê³„ íŒŒì¼(ë“œë¡œí¼/ìŠ¤í¬ë¦½íŠ¸)ì´ ìˆë‚˜?** â†’ ShimCache/íŒŒì¼ì‹œìŠ¤í…œ  
6) **ìœ ì…(ì„¤ì¹˜) í”ì ì€ ë” ì—†ë‚˜?** â†’ Amcacheë¡œ ê°•í™”  
7) **ëˆ„ê°€ ì‹¤í–‰ì‹œì¼°ë‚˜(ë¶€ëª¨ í”„ë¡œì„¸ìŠ¤)?** â†’ Sysmon/ë³´ì•ˆë¡œê·¸  
8) **ì»¤ë§¨ë“œë¼ì¸ì€ ë¬´ì—‡ì´ì—ˆë‚˜?** â†’ PowerShell/rundll32/mshta ë“± ì‹ë³„  
9) **ë‹¤ì‹œ ì‹¤í–‰ë˜ê²Œ ë§Œë“  íŠ¸ë¦¬ê±°ëŠ”?** â†’ ì‘ì—…/ì„œë¹„ìŠ¤/WMI  
10) **Prefetchê°€ ë¹„ì–´ ìˆë‹¤ë©´?** â†’ MFT/USNìœ¼ë¡œ ìƒì„± êµ°ì§‘ ì¬êµ¬ì„±  

---

## ğŸ“Œ ê²°ë¡ 

- **ShimCacheëŠ” â€œì¡´ì¬â€ì˜ ê°•í•œ ë‹¨ì„œ**ì…ë‹ˆë‹¤.  
- **PrefetchëŠ” â€œì‹¤í–‰â€ì„ ë’·ë°›ì¹¨í•˜ëŠ” ê°•ë ¥í•œ ì¦ê±°**ì…ë‹ˆë‹¤.  
- ê·¸ëŸ¬ë‚˜ ì•…ì„±ì½”ë“œ ë¶„ì„ì˜ í•µì‹¬ì€ ê²°êµ­ ì´ê²ƒì…ë‹ˆë‹¤.

> **PrefetchëŠ” ì‹œì‘ì ì´ì§€ ê²°ë¡ ì´ ì•„ë‹ˆë‹¤.**  
> í•µì‹¬ì€ **â€œëˆ„ê°€ ì‹¤í–‰í–ˆëŠ”ê°€, ë¬´ì—‡ì„ ë¶ˆë €ëŠ”ê°€, ì–´ë–»ê²Œ ë‹¤ì‹œ ì‚´ì•„ë‚¬ëŠ”ê°€â€**ë‹¤.

---

## ì°¸ê³  ë§í¬

[1]: https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon "Sysmon - Sysinternals (Microsoft Learn)"
[2]: https://learn.microsoft.com/en-us/previous-versions/windows/it-pro/windows-10/security/threat-protection/auditing/event-4688 "4688(S) A new process has been created (Microsoft Learn)"
[3]: https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/component-updates/command-line-process-auditing "Command line process auditing (Microsoft Learn)"
[4]: https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_logging_windows?view=powershell-7.5 "about_Logging_Windows - PowerShell (Microsoft Learn)"
[5]: https://research.splunk.com/endpoint/b3632472-310b-11ec-9aab-acde48001122/ "WinEvent Windows Task Scheduler Event Action Started (Splunk Research)"
[6]: https://docs.nxlog.co/integrate/wmi.html "Windows Management Instrumentation (WMI) (NXLog Documentation)"
[7]: https://redcanary.com/threat-detection-report/techniques/windows-management-instrumentation/ "Windows Management Instrumentation (Red Canary)"
[8]: https://lolbas-project.github.io/ "LOLBAS Project"
