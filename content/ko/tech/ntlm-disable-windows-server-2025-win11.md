---
title: "Pass-the-Hash가 ‘너무 쉬운’ 이유: NTLM Disable + Windows Server 2025·Windows 11(22H2 기준)로 가야 하는 이유 🔐"
date: 2025-12-30
draft: false
description: "PtH는 특정 CVE가 아니라 ‘NTLM을 허용하는 한’ 구조적으로 재현되는 위험입니다. 해시 탈취면을 줄이고(Anti-dumping), NTLM을 감사→차단으로 줄이기 위해 Server 2025·Win11(22H2 이상)을 기준선으로 삼아야 합니다."
featured_image: "cdn/tech/ntlm-disable.png"
tags: ["Windows", "Windows Server 2025", "Windows 11", "Active Directory", "NTLM", "Pass-the-Hash", "Credential Guard", "LSA Protection", "LAPS", "Hardening"]
---

> **한 줄 요약**:  
> 🧨 **PtH는 ‘취약점’이 아니라 ‘NTLM을 허용할 때 생기는 구조적 리스크’**입니다.  
> 🔓 해시가 한 번 털리면 “재사용”이 가능해지므로, **운영 목표는 NTLM Disable(감사→예외정리→차단)** 입니다.  
> 🚀 그 목표를 현실적으로 달성하려면 **Windows Server 2025 + Windows 11(22H2 이상)** 을 기준선으로 빠르게 올려야 합니다.

* **NTLM**: Windows 인증 프로토콜(해시 기반 인증 경로가 남으면 PtH가 가능해짐)
* **PtH (Pass-the-Hash)**: 비밀번호 대신 **탈취된 NTLM 해시**로 인증을 “재사용”하는 공격
* **LSASS**: 자격증명(해시/티켓 등)이 머물 수 있는 프로세스 → 공격자는 여기서 “훔칠 거리”를 찾음
* **핵심 결론**: “OS만 최신이면 안전”이 아니라, **NTLM을 줄이고(가능하면 차단) + 해시 탈취를 어렵게** 해야 안전합니다.

<!--more-->

![NTLM Disable](https://blog.plura.io/cdn/tech/ntlm-disable.png)

## Executive Summary ✨

많은 조직에서 PtH(패스더해시)는 여전히 “현실적으로 가장 빠른 내부 확산(lateral movement) 경로”입니다. 이유는 단순합니다.

1) **NTLM을 허용하는 한**, 해시가 탈취되면 “재사용”이 가능한 구조이기 때문입니다.  
2) 레거시(구형 OS/장비/앱)·운영 습관(공통 로컬 관리자, 특권계정 상시 로그인)이 결합되면, 공격자는 **취약점 익스플로잇 없이도** 내부를 옮겨 다닐 수 있습니다.  
3) 그래서 목표는 “취약점 패치만”이 아니라 **NTLM Disable**입니다. 단, 한 번에 끊으면 장애가 나므로 **Audit → 예외 정리 → Deny**로 가야 합니다.

**Windows Server 2025 / Windows 11(22H2 이상)** 은 이 목표를 “가능하게” 만드는 기반을 제공합니다.

* **NTLMv1 제거(서버 2025)** 같은 강제 정리 구간이 시작되었고,
* **Credential Guard / LSA 보호(LSASS 보호)** 등으로 **해시 탈취면 자체를 줄이는** 방향이 강화되었으며,
* **Restrict NTLM(감사→차단)** 정책 운영이 성숙해 “어디서 NTLM이 쓰이는지”를 먼저 찾고 끊을 수 있습니다.

---

## 1) 문제의 심각성: PtH는 “특정 CVE”가 아니라 “구조적 재현” 😨

PtH를 이해할 때 중요한 관점은 이것입니다.

> **NTLM은 ‘비밀번호를 아는지’가 아니라, (비밀번호에서 파생된) ‘해시를 아는지’로 인증이 성립하는 구간이 존재합니다.**  
> 그래서 해시가 유출되면, 공격자는 “그 해시”로 인증을 재시도할 수 있습니다.

즉, 아래 조건 중 하나라도 있으면 “버전과 관계없이” PtH는 원리적으로 성립합니다.

* 도메인/서버/클라이언트에 **NTLM 인증 경로가 남아 있음**
* **해시가 남아있거나 뽑힐 여지(LSASS, 캐시, 덤프, 백업, 오프라인 추출 등)** 가 있음
* 그 해시로 접근 가능한 **권한/경로(SMB/RPC/RDP/서비스 계정/관리자 그룹 등)** 가 있음

---

## 2) “얼마나 쉽게 공격받나?”: 현실적인 확산 시나리오 5단계 🧩

아래 흐름은 침투 사고에서 매우 자주 반복됩니다.

1. **초기 침투**: 피싱/취약한 웹앱/원격접속 계정 탈취 등으로 “한 대”를 먼저 확보  
2. **권한 상승**: 로컬 관리자/서비스 권한 획득  
3. **자격증명 탈취**: LSASS 메모리, 크리덴셜 캐시, 취약한 설정을 통해 NTLM 해시/티켓을 확보  
4. **재사용(=PtH)**: 얻은 해시로 다른 서버/PC에 인증(특히 SMB/원격관리 경로)  
5. **가로이동 확산**: 공통 로컬 관리자/특권계정 로그인 습관/레거시 NTLM 때문에 연쇄 확산

여기서 포인트는 4번입니다.

> **해시가 “재사용 가능한 열쇠”가 되는 순간**,  
> 공격자는 “취약점 개발자”가 아니라 “운영 실수 수집가”가 됩니다.

---

## 3) PtH를 키우는 운영 패턴 Top 6 (빠른 자가진단) 🧯

아래 항목이 많을수록, “한 번 뚫리면 크게 번질” 확률이 올라갑니다.

1) **NTLM fallback 허용**(Kerberos 실패 시 NTLM로 떨어짐)  
2) **공통 로컬 관리자 계정/비밀번호 재사용**(PC/서버 전반)  
3) **특권계정(도메인 관리자/서버 관리자)의 상시 로그인**(일반 멤버 서버, 파일서버 등)  
4) **구형 OS(서버/클라이언트)와 레거시 장비/앱이 섞여 있음**  
5) **RDP/원격관리 경로가 넓고, 자격증명 노출 방어가 약함**  
6) **NTLM 사용처를 모른다**(감사 로그/대시보드/예외 목록 부재)

> ✅ 이 중에서 “2번(로컬 관리자 재사용)”과 “6번(가시성 없음)”은 특히 치명적입니다.  
> **한 번 얻은 해시가 곧바로 옆 장비로 이동할 수 있는 구조**가 되기 때문입니다.

---

## 4) 그래서 목표는 “NTLM Disable” 🎯 (단, 한 번에 하지 말 것)

NTLM Disable은 “체크박스 하나”가 아니라 **운영 체계**입니다.

### 목표 상태(이상적인 모습)

* 인증은 **Kerberos/Negotiate 중심**
* NTLM은 **원칙적으로 차단**
* 불가피한 예외(레거시)는
  * **소유자(Owner)**
  * **만료일(Expiry)**
  * **대체 계획(Migration plan)**
  * **격리(네트워크/권한/접속경로 제한)**
  를 갖춘 “관리 대상”으로만 남음

### 추천 전환 방식: Audit → Exception Cleanup → Deny

1) **Audit(감사)**: 어디서, 누구(계정/호스트)가, 어떤 이유로 NTLM을 쓰는지 수집  
2) **Exception 정리**: Kerberos로 전환 가능한 항목(예: SPN/DNS/시간 동기화 문제, IP로 접근 등)을 먼저 수정  
3) **Deny(차단)**: 예외를 최소화한 뒤 단계적으로 차단(서버 단위 → OU 단위 → 도메인 단위)

---

## 5) 왜 “Windows Server 2025 + Windows 11 22H2(이상)”인가? 🆙

PtH는 “NTLM이 남으면” 성립하지만, **OS 세대에 따라 ‘얼마나 쉽게 해시를 훔칠 수 있는지’** 가 크게 달라집니다.

### 1) 레거시 위험(특히 NTLMv1)을 빠르게 정리하는 흐름

Windows Server 2025는 **NTLMv1 제거**와 같은 큰 정리 흐름이 시작되는 구간입니다.  
조직 입장에서는 “레거시를 계속 끌고 갈 수 있는 시간”이 줄어듭니다.

> 요약: **서버 2025로 올라가야, NTLMv1/레거시 인증 부채를 끝낼 수 있는 동력이 생깁니다.**

### 2) 해시 탈취(credential dumping) 자체를 어렵게 만드는 기본값 강화

최신 OS는 아래 축에서 유리합니다.

* **Credential Guard**: NTLM 해시·Kerberos TGT 등 “훔칠 거리”를 격리/보호하는 방향  
* **LSA 보호(LSASS 보호)**: LSASS 메모리 읽기/코드 인젝션을 더 어렵게 만드는 방향

> 중요한 현실 체크:  
> 기능이 “있다”와 “켜져 있다”는 다릅니다.  
> **요건 충족 + 정책 적용 + 검증(이벤트/설정 확인)** 까지 해야 효과가 생깁니다.

### 3) NTLM을 ‘감사→차단’하는 운영 도구가 성숙

구성 요소(정책/이벤트/로깅)가 성숙해질수록, “한 번에 끊고 장애”가 아니라  
**증거 기반으로 끊는 마이그레이션**이 가능합니다.

---

## 6) 서버/클라이언트 운영 원칙(요약) 🧱

### 서버(DC vs 멤버 서버)로 나눠 생각하기

* **DC(도메인 컨트롤러)**:  
  * 인증의 중심 → “여기서 뚫리면 끝”  
  * 목표: **특권 계정 경로 최소화, NTLM 단계적 축소, 백업/NTDS 보호, 로그/감사 강화**
* **멤버 서버(파일/웹/DB 등)**:  
  * 침투/확산의 통로가 되기 쉬움  
  * 목표: **Credential Guard/LSA 보호 같은 덤핑 방어 + 관리자 접속 보호 + LAPS**로 확산 차단

### 클라이언트(일반 단말 vs 관리자 단말)로 나눠 생각하기

* **일반 사용자 단말**: 피싱/악성코드 유입 가능성이 높음 → “첫 침투 지점”  
* **관리자 단말(PAW/점프박스)**: “도메인 권한이 머무는 자리” → 여기 보호가 핵심

> 결론:  
> **관리자 권한은 ‘관리자 단말’에서만**, 일반 서버/PC에는 가능한 한 남기지 않는 구조가 가장 강합니다.

---

## 7) 실무 로드맵: 30/60/90일로 NTLM Disable에 접근하기 🗺️

### D+30: “보이게 만들고(감사)”, “확산 촉매부터 끊기”

* **NTLM 감사(Audit) 켜기**:  
  * DC/서버/클라이언트 별로 “NTLM 사용처” 수집(이벤트 기반)
* **Windows LAPS 도입**:  
  * 로컬 관리자 비밀번호를 “장비마다 다르게” 회전 → PtH 확산 경로 차단
* **관리자 로그인 경로 정리**:  
  * 특권계정이 일반 서버에 로그인하는 습관부터 줄이기(점프 서버/PAW 도입 시작)
* **신규 구축은 즉시 최신 OS 기준선 적용**:  
  * 새 서버/새 PC는 Server 2025 / Win11(22H2 이상)로만 배포

### D+60: 예외 정리 + “부분 차단” 시작

* 감사 결과로 **상위 NTLM 의존 20개**를 식별  
  * 레거시 앱/장비/접속 방식(IP 접근, SPN 미구성 등)을 “Kerberos로 돌릴 수 있는 것부터” 수정
* **Outgoing NTLM 통제**(클라이언트):  
  * 원칙 차단을 목표로, 업무 영향이 적은 OU부터 단계 적용
* **Remote Credential Guard/Restricted Admin 적용 확대**(관리자 RDP 경로 보호)
* **Protected Users**는 “특권계정부터” 제한적으로 시범 적용(호환성 테스트 필수)

### D+90: NTLM Disable(예외 최소화) 목표 정착

* 도메인/OU 단위로 **NTLM 차단(Deny)** 적용 범위를 확대  
* 예외는 “임시”가 아니라 **만료일/소유자/대체 계획**이 있는 관리 대상만 유지  
* 운영 지표를 바꿈:
  * “NTLM 이벤트 0에 수렴”
  * “LAPS 적용률 90%+”
  * “특권계정의 일반 서버 로그인 0에 수렴”

---

## 8) 체크리스트 ✅ (운영 점검용)

### 가시성(반드시 먼저)

- [ ] DC/서버/클라이언트에 **NTLM 감사 로그**가 수집되고 있는가?
- [ ] “NTLM 사용처(앱/장비/계정/서버)”가 **목록화**되어 있는가?
- [ ] 예외마다 **Owner/만료일/대체계획**이 있는가?

### 확산 차단(가장 효과 빠름)

- [ ] **Windows LAPS**로 로컬 관리자 재사용이 사라졌는가?
- [ ] 관리자 접속은 **점프 서버/PAW** 중심으로 통제되는가?
- [ ] Remote Credential Guard/Restricted Admin 같은 **자격증명 노출 최소화**가 적용되었는가?

### 덤핑 방어(멤버 서버/관리 단말 중심)

- [ ] (요건 충족 시) **Credential Guard / LSA 보호**가 “실제로” 활성화되어 있는가?
- [ ] 공격자가 LSASS에서 “훔칠 거리”를 얻기 어려운 상태인가?

---

## 결론 🔚

PtH는 ‘어딘가의 취약점’을 고치는 것으로 끝나지 않습니다.  
**NTLM을 허용하는 한** 해시 탈취와 재사용은 계속 재현됩니다.

그래서 우리가 해야 할 일은 명확합니다.

1) **NTLM Disable(감사→예외정리→차단)** 로 운영 체계를 바꾸고,  
2) 그 목표를 현실적으로 달성하기 위해 **Windows Server 2025 + Windows 11(22H2 이상)** 을 기준선으로 빠르게 올립니다.  
3) 그리고 “OS 최신 + 정책(Restrict NTLM) + 운영(LAPS/특권계정 분리)”이 함께 돌아가게 만듭니다.

---

*이 문서는 첨부된 블로그 양식(soc-burnout.md)의 구조(Front matter/요약/로드맵/체크리스트)를 참고해 작성되었습니다.*
